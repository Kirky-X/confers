<span id="top"></span>
<div align="center">

<img src="../resource/confers.png" alt="Confers Logo" width="150" style="margin-bottom: 16px">

# ğŸ“– ç”¨æˆ·æŒ‡å—

[ğŸ  é¦–é¡µ](../README.md) â€¢ [ğŸ“š æ–‡æ¡£](../README.md) â€¢ [ğŸ¯ ç¤ºä¾‹](../examples/) â€¢ [â“ å¸¸è§é—®é¢˜](FAQ.md)

---

</div>

## ğŸ“‹ ç›®å½•

<details open style="padding:16px">
<summary style="cursor:pointer; font-weight:600; color:#1E293B">ğŸ“‘ ç›®å½•ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>

- [ç®€ä»‹](#ç®€ä»‹)
- [å¿«é€Ÿå…¥é—¨](#å¿«é€Ÿå…¥é—¨)
  - [å…ˆå†³æ¡ä»¶](#å…ˆå†³æ¡ä»¶)
  - [å®‰è£…](#å®‰è£…)
  - [ç¬¬ä¸€æ­¥](#ç¬¬ä¸€æ­¥)
- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [å‘½ä»¤è¡Œå·¥å…·](#å‘½ä»¤è¡Œå·¥å…·)
- [åŸºç¡€ç”¨æ³•](#åŸºç¡€ç”¨æ³•)
- [é«˜çº§ç”¨æ³•](#é«˜çº§ç”¨æ³•)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [åç»­æ­¥éª¤](#åç»­æ­¥éª¤)

</details>

---

## ç®€ä»‹

<div align="center" style="margin: 24px 0">

### ğŸ¯ ä½ å°†å­¦åˆ°ä»€ä¹ˆ

</div>

<table style="width:100%; border-collapse: collapse">
<tr>
<td align="center" width="25%" style="padding: 16px">
<img src="https://img.icons8.com/fluency/96/000000/rocket.png" width="48" height="48"><br>
<b style="color:#166534">å¿«é€Ÿå…¥é—¨</b><br>
<span style="color:#166534">5 åˆ†é’Ÿå†…å®Œæˆç¯å¢ƒæ­å»º</span>
</td>
<td align="center" width="25%" style="padding: 16px">
<img src="https://img.icons8.com/fluency/96/000000/settings.png" width="48" height="48"><br>
<b style="color:#1E40AF">çµæ´»é…ç½®</b><br>
<span style="color:#1E40AF">æ”¯æŒå¤šç§æºä¸æ ¼å¼</span>
</td>
<td align="center" width="25%" style="padding: 16px">
<img src="https://img.icons8.com/fluency/96/000000/code.png" width="48" height="48"><br>
<b style="color:#92400E">æœ€ä½³å®è·µ</b><br>
<span style="color:#92400E">å­¦ä¹ è§„èŒƒçš„é…ç½®ç®¡ç†</span>
</td>
<td align="center" width="25%" style="padding: 16px">
<img src="https://img.icons8.com/fluency/96/000000/rocket-take-off.png" width="48" height="48"><br>
<b style="color:#5B21B6">é«˜çº§ç‰¹æ€§</b><br>
<span style="color:#5B21B6">æŒæ¡çƒ­é‡è½½ä¸è¿œç¨‹é…ç½®</span>
</td>
</tr>
</table>

**confers** æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Rust é…ç½®ç®¡ç†åº“ï¼Œæ—¨åœ¨ç®€åŒ–åº”ç”¨ç¨‹åºçš„é…ç½®åŠ è½½ã€éªŒè¯å’Œç®¡ç†ã€‚å®ƒæ”¯æŒä»æ–‡ä»¶ï¼ˆJSON, TOML, YAMLï¼‰ã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°ä»¥åŠè¿œç¨‹æºï¼ˆEtcd, HTTPï¼‰åŠ è½½é…ç½®ã€‚

<div style="padding:16px; margin: 16px 0">> ğŸ’¡ **æç¤º**: æœ¬æŒ‡å—å‡è®¾ä½ å…·å¤‡åŸºæœ¬çš„ Rust çŸ¥è¯†ã€‚å¦‚æœä½ æ˜¯ Rust æ–°æ‰‹ï¼Œå»ºè®®å…ˆé˜…è¯» [Rust å®˜æ–¹æ•™ç¨‹](https://doc.rust-lang.org/book/)ã€‚

</div>

---

## å¿«é€Ÿå…¥é—¨

### å…ˆå†³æ¡ä»¶

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š

<table style="width:100%; border-collapse: collapse">
<tr>
<td width="50%" style="padding: 16px">

**å¿…é€‰**
- âœ… Rust 1.75+ (stable)
- âœ… Cargo (éš Rust ä¸€èµ·å®‰è£…)
- âœ… Git

</td>
<td width="50%" style="padding: 16px">

**å¯é€‰**
- ğŸ”§ æ”¯æŒ Rust çš„ IDE (å¦‚ VS Code + rust-analyzer)
- ğŸ”§ Docker (ç”¨äºå®¹å™¨åŒ–éƒ¨ç½²)
- ğŸ”§ Etcd (ç”¨äºè¿œç¨‹é…ç½®æµ‹è¯•)

</td>
</tr>
</table>

<details style="padding:16px; margin: 16px 0">
<summary style="cursor:pointer; font-weight:600; color:#1E293B">ğŸ” éªŒè¯å®‰è£…</summary>

```bash
# æ£€æŸ¥ Rust ç‰ˆæœ¬
rustc --version
# é¢„æœŸ: rustc 1.75.0 (æˆ–æ›´é«˜)

# æ£€æŸ¥ Cargo ç‰ˆæœ¬
cargo --version
# é¢„æœŸ: cargo 1.75.0 (æˆ–æ›´é«˜)
```

</details>

### å®‰è£…

åœ¨ä½ çš„ `Cargo.toml` ä¸­æ·»åŠ  `confers`ï¼š

<div style="padding:16px; margin: 16px 0">

| å®‰è£…ç±»å‹ | é…ç½® | ä½¿ç”¨åœºæ™¯ |
|----------|------|----------|
| **é»˜è®¤** | `confers = "0.2.0"` | åŒ…å« deriveã€validation å’Œ CLI |
| **æœ€å°åŒ–** | `confers = { version = "0.2.0", default-features = false, features = ["minimal"] }` | ä»…é…ç½®åŠ è½½ |
| **æ¨è** | `confers = { version = "0.2.0", default-features = false, features = ["recommended"] }` | é…ç½® + éªŒè¯ |
| **å®Œæ•´** | `confers = { version = "0.2.0", features = ["full"] }` | æ‰€æœ‰åŠŸèƒ½ |

**å¯ç”¨ç‰¹æ€§é¢„è®¾ï¼š**

| é¢„è®¾ | ç‰¹æ€§ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| <span style="color:#166534; padding:4px 8px">minimal</span> | `derive` | ä»…é…ç½®åŠ è½½ |
| <span style="color:#1E40AF; padding:4px 8px">recommended</span> | `derive`, `validation` | é…ç½®åŠ è½½ + éªŒè¯ |
| <span style="color:#92400E; padding:4px 8px">dev</span> | `derive`, `validation`, `cli`, `schema`, `audit`, `monitoring` | å¼€å‘é…ç½® |
| <span style="color:#991B1B; padding:4px 8px">production</span> | `derive`, `validation`, `watch`, `encryption`, `remote`, `monitoring` | ç”Ÿäº§é…ç½® |
| <span style="color:#5B21B6; padding:4px 8px">full</span> | æ‰€æœ‰ç‰¹æ€§ | å®Œæ•´åŠŸèƒ½é›† |

**å•ç‹¬ç‰¹æ€§ï¼š**

| ç‰¹æ€§ | æè¿° | é»˜è®¤ |
|------|------|------|
| `derive` | é…ç½®ç»“æ„ä½“çš„ derive å® | âœ… |
| `validation` | é…ç½®éªŒè¯æ”¯æŒ | âœ… |
| `cli` | å‘½ä»¤è¡Œå·¥å…· | âŒ |
| `watch` | æ–‡ä»¶ç›‘æ§å’Œçƒ­é‡è½½ | âŒ |
| `audit` | å®¡è®¡æ—¥å¿— | âŒ |
| `schema` | JSON Schema ç”Ÿæˆ | âŒ |
| `parallel` | å¹¶è¡ŒéªŒè¯ | âŒ |
| `monitoring` | ç³»ç»Ÿç›‘æ§ | âŒ |
| `remote` | è¿œç¨‹é…ç½®ï¼ˆetcdã€consulã€httpï¼‰ | âŒ |
| `encryption` | é…ç½®åŠ å¯† | âŒ |

</div>

å¦‚æœéœ€è¦å¼‚æ­¥/è¿œç¨‹æ”¯æŒï¼Œæ·»åŠ  tokioï¼š
```toml
[dependencies]
tokio = { version = "1.0", features = ["full"] }
```

### ç¬¬ä¸€æ­¥

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥éªŒè¯å®‰è£…ã€‚æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªåŒ…å«é»˜è®¤å€¼å’Œç¯å¢ƒå˜é‡æ˜ å°„çš„é…ç½®ç»“æ„ä½“ï¼š

```rust
use confers::Config;
use serde::{Deserialize, Serialize};

#[derive(Debug, Serialize, Deserialize, Config)]
#[config(env_prefix = "APP")]
struct AppConfig {
    #[config(default = "8080")]
    port: u16,
    
    #[config(default = "\"localhost\".to_string()")]
    host: String,
}

fn main() {
    // åŠ è½½é…ç½®ï¼ˆæŒ‰é¡ºåºï¼šé»˜è®¤å€¼ -> é…ç½®æ–‡ä»¶ -> ç¯å¢ƒå˜é‡ï¼‰
    let config = AppConfig::load().await.expect("æ— æ³•åŠ è½½é…ç½®");
    
    println!("ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨: {}:{}", config.host, config.port);
}
```

---

## æ ¸å¿ƒæ¦‚å¿µ

ç†è§£è¿™äº›æ ¸å¿ƒæ¦‚å¿µå°†å¸®åŠ©ä½ æ›´æœ‰æ•ˆåœ°ä½¿ç”¨ `confers`ã€‚

<div align="center" style="margin: 24px 0">

### ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

</div>

```mermaid
graph TB
    subgraph Sources ["ğŸ“¥ é…ç½®æ¥æº"]
        A[ğŸ“ é…ç½®æ–‡ä»¶<br/>JSON, TOML, YAML]
        B[ğŸŒ ç¯å¢ƒå˜é‡]
        C[ğŸ’» CLI å‚æ•°]
        D[â˜ï¸ è¿œç¨‹æº<br/>Etcd, Consul, HTTP]
    end
    
    subgraph Priority ["ğŸ“Š ä¼˜å…ˆçº§ï¼ˆé«˜â†’ä½ï¼‰"]
        P1["ğŸ’» CLI å‚æ•°<br/>æœ€é«˜ä¼˜å…ˆçº§"]
        P2["ğŸŒ ç¯å¢ƒå˜é‡"]
        P3["ğŸ“ é…ç½®æ–‡ä»¶"]
        P4["ğŸ”§ é»˜è®¤å€¼<br/>æœ€ä½ä¼˜å…ˆçº§"]
    end
    
    subgraph Result ["ğŸ“¤ ç»“æœ"]
        R[ğŸš€ ç±»å‹å®‰å…¨é…ç½®]
    end
    
    Sources --> Priority
    Priority --> R
    
    style Sources fill:#DBEAFE,stroke:#1E40AF
    style Priority fill:#FEF3C7,stroke:#92400E
    style Result fill:#DCFCE7,stroke:#166534
```

### 1ï¸âƒ£ `Config` æ´¾ç”Ÿå®

`confers` çš„æ ¸å¿ƒæ˜¯ `Config` æ´¾ç”Ÿå®ã€‚å®ƒä¼šè‡ªåŠ¨ä¸ºä½ çš„ç»“æ„ä½“å®ç°é…ç½®åŠ è½½é€»è¾‘ï¼ŒåŒ…æ‹¬å¤„ç†é»˜è®¤å€¼ã€ç¯å¢ƒå˜é‡å‰ç¼€å’ŒéªŒè¯è§„åˆ™ã€‚

### 2ï¸âƒ£ å±‚æ¬¡åŒ–åŠ è½½

`confers` éµå¾ª"æœ€åå®šä¹‰çš„èƒœå‡º"åŸåˆ™ï¼ŒæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§åˆå¹¶é…ç½®ï¼š
1. **å‘½ä»¤è¡Œå‚æ•°** (æœ€é«˜ä¼˜å…ˆçº§)
2. **ç¯å¢ƒå˜é‡**
3. **é…ç½®æ–‡ä»¶** (å¦‚ `config.toml`)
4. **é»˜è®¤å€¼** (æœ€ä½ä¼˜å…ˆçº§)

### 3ï¸âƒ£ çµæ´»çš„æ•°æ®æº

ä½ å¯ä»¥è½»æ¾åœ°ä»ä¸åŒæ¥æºç»„åˆé…ç½®ï¼š
- **æ–‡ä»¶**: æ”¯æŒè‡ªåŠ¨æ£€æµ‹ JSON, TOML, YAML æ ¼å¼ã€‚
- **ç¯å¢ƒ**: é€šè¿‡ `env_prefix` è‡ªåŠ¨æ˜ å°„ç¯å¢ƒå˜é‡ã€‚
- **è¿œç¨‹**: æ”¯æŒ Etcdã€Consul å’Œ HTTP è½®è¯¢/ç›‘å¬ã€‚

---

## å‘½ä»¤è¡Œå·¥å…·

confers æä¾›äº†åŠŸèƒ½å®Œæ•´çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒé…ç½®æ–‡ä»¶çš„ç”Ÿæˆã€éªŒè¯ã€åŠ å¯†ã€å·®åˆ†ç­‰åŠŸèƒ½ã€‚

### å®‰è£… CLI

```bash
# ä»æºç å®‰è£…
cargo install confers

# æˆ–ä» crates.io å®‰è£…
cargo install confers-cli

# æŸ¥çœ‹ç‰ˆæœ¬
confers --version

# æŸ¥çœ‹å¸®åŠ©
confers --help
```

### å‘½ä»¤å‚è€ƒ

```bash
confers 0.2.0
A powerful Rust configuration management library

USAGE:
    confers [OPTIONS] <SUBCOMMAND>

OPTIONS:
    -h, --help         æ‰“å°å¸®åŠ©ä¿¡æ¯
    -V, --version      æ‰“å°ç‰ˆæœ¬ä¿¡æ¯
    -v, --verbose      å¯ç”¨è¯¦ç»†è¾“å‡º (-vv æ›´è¯¦ç»†)

SUBCOMMANDS:
    diff       æ¯”è¾ƒä¸¤ä¸ªé…ç½®æ–‡ä»¶çš„å·®å¼‚
    generate   ç”Ÿæˆé…ç½®æ¨¡æ¿
    validate   éªŒè¯é…ç½®æ–‡ä»¶
    encrypt    åŠ å¯†æ•æ„Ÿé…ç½®
    wizard     äº¤äº’å¼é…ç½®ç”Ÿæˆå‘å¯¼
    key        ç”Ÿæˆå’Œç®¡ç†åŠ å¯†å¯†é’¥
    help       æ‰“å°å¸®åŠ©ä¿¡æ¯
```

### diff - é…ç½®å·®åˆ†

<div style="padding:16px; margin: 16px 0">

æ¯”è¾ƒä¸¤ä¸ªé…ç½®æ–‡ä»¶çš„å·®å¼‚ï¼Œæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ï¼š

</div>

```bash
# åŸºæœ¬ç”¨æ³• - æ¯”è¾ƒä¸¤ä¸ªé…ç½®æ–‡ä»¶
confers diff config1.toml config2.toml

# æŒ‡å®šè¾“å‡ºæ ¼å¼
confers diff config1.toml config2.toml --format unified    # ç»Ÿä¸€ diff æ ¼å¼
confers diff config1.toml config2.toml --format context    # ä¸Šä¸‹æ–‡ diff æ ¼å¼
confers diff config1.toml config2.toml --format normal     # æ ‡å‡† diff æ ¼å¼
confers diff config1.toml config2.toml --format side-by-side  # å¹¶æ’å¯¹æ¯”æ ¼å¼
confers diff config1.toml config2.toml --format strict     # ä¸¥æ ¼æ¨¡å¼

# ç”ŸæˆæŠ¥å‘Š
confers diff config1.toml config2.toml -o diff_report.md

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers diff --help
```

**è¾“å‡ºæ ¼å¼è¯´æ˜ï¼š**

| æ ¼å¼ | æè¿° | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `unified` | ç»Ÿä¸€ diff æ ¼å¼ï¼Œå«è¡Œå·å’Œä¸Šä¸‹æ–‡ | ä»£ç å®¡æŸ¥ã€ç‰ˆæœ¬å¯¹æ¯” |
| `context` | ä¸Šä¸‹æ–‡ diff æ ¼å¼ | æŸ¥çœ‹å˜æ›´ä¸Šä¸‹æ–‡ |
| `normal` | æ ‡å‡† diff æ ¼å¼ | ç®€å•å·®å¼‚å¯¹æ¯” |
| `side-by-side` | å¹¶æ’å¯¹æ¯”æ ¼å¼ | å¯è§†åŒ–å¯¹æ¯” |
| `strict` | ä¸¥æ ¼æ¨¡å¼ï¼Œä»…æ˜¾ç¤ºå®é™…å·®å¼‚ | ç²¾ç¡®å·®å¼‚åˆ†æ |

### generate - æ¨¡æ¿ç”Ÿæˆ

```bash
# åŸºæœ¬ç”¨æ³•
confers generate --struct "AppConfig" --output config_template.toml

# æŒ‡å®šè¾“å‡ºæ ¼å¼
confers generate --struct "AppConfig" --format toml --output config.toml
confers generate --struct "AppConfig" --format yaml --output config.yaml
confers generate --struct "AppConfig" --format json --output config.json

# æŒ‡å®šè¾“å‡ºçº§åˆ«
confers generate --struct "AppConfig" --level minimal    # æœ€å°è¾“å‡º
confers generate --struct "AppConfig" --level full       # å®Œæ•´è¾“å‡º
confers generate --struct "AppConfig" --level doc        # æ–‡æ¡£åŒ–è¾“å‡º

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers generate --help
```

**è¾“å‡ºçº§åˆ«è¯´æ˜ï¼š**

| çº§åˆ« | æè¿° | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `minimal` | ä»…åŒ…å«å¿…éœ€å­—æ®µå’Œæ³¨é‡Š | å¿«é€Ÿå¼€å§‹ |
| `full` | åŒ…å«æ‰€æœ‰å­—æ®µã€é»˜è®¤å€¼å’Œæ³¨é‡Š | å®Œæ•´é…ç½® |
| `doc` | åŒ…å«å­—æ®µè¯´æ˜æ–‡æ¡£ | æ–‡æ¡£ç”Ÿæˆ |

### validate - é…ç½®éªŒè¯

```bash
# åŸºæœ¬ç”¨æ³• - éªŒè¯é…ç½®æ–‡ä»¶
confers validate config.toml

# æŒ‡å®šè¾“å‡ºçº§åˆ«
confers validate config.toml --level minimal    # æœ€å°è¾“å‡º
confers validate config.toml --level full       # å®Œæ•´è¾“å‡º
confers validate config.toml --level doc        # æ–‡æ¡£åŒ–è¾“å‡º

# è·³è¿‡ä¸¥æ ¼æ¨¡å¼
confers validate config.toml --no-strict

# éªŒè¯å¹¶ç”ŸæˆæŠ¥å‘Š
confers validate config.toml -o validation_report.md

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers validate --help
```

### encrypt - é…ç½®åŠ å¯†

```bash
# åŠ å¯†é…ç½®æ–‡ä»¶
confers encrypt input.toml --key-file secret.key --output encrypted.toml

# åŠ å¯†å•ä¸ªå€¼
confers encrypt "sensitive_value" --key-file secret.key

# è§£å¯†é…ç½®æ–‡ä»¶
confers encrypt encrypted.toml --key-file secret.key --decrypt --output decrypted.toml

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers encrypt --help
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```bash
# ç”Ÿæˆå¯†é’¥å¹¶åŠ å¯†
confers key -o secret.key
confers encrypt config.toml --key-file secret.key -o config.encrypted.toml

# è§£å¯†ä½¿ç”¨
confers encrypt config.encrypted.toml --key-file secret.key --decrypt -o config.toml
```

### wizard - äº¤äº’å¼å‘å¯¼

```bash
# å¯åŠ¨äº¤äº’å¼å‘å¯¼
confers wizard

# æŒ‡å®šé…ç½®æ–‡ä»¶ç±»å‹
confers wizard --format toml
confers wizard --format yaml
confers wizard --format json

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers wizard --help
```

**å‘å¯¼æµç¨‹ï¼š**

1. è¾“å…¥é…ç½®åç§°
2. è®¾ç½®æœåŠ¡å™¨å‚æ•°ï¼ˆhostã€portï¼‰
3. é…ç½®æ•°æ®åº“è¿æ¥ï¼ˆurlã€poolï¼‰
4. é…ç½®æ—¥å¿—çº§åˆ«
5. ç”Ÿæˆé…ç½®æ–‡ä»¶

### key - å¯†é’¥ç®¡ç†

```bash
# ç”Ÿæˆæ–°å¯†é’¥
confers key -o encryption.key

# ç”Ÿæˆ 256 ä½å¯†é’¥
confers key --length 256 -o encryption.key

# ä»å¯†ç æ´¾ç”Ÿå¯†é’¥
confers key --derive --password "your_password" -o derived.key

# æŸ¥çœ‹å¯†é’¥ä¿¡æ¯
confers key --info encryption.key

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers key --help
```

---

## åŸºç¡€ç”¨æ³•

### å®šä¹‰é…ç½®ç»“æ„ä½“

<div style="padding:16px; margin: 16px 0">

ä½¿ç”¨ `#[derive(Config)]` å’Œ `#[config(...)]` å±æ€§æ¥é…ç½®ä½ çš„ç»“æ„ä½“ã€‚ä½ è¿˜å¯ä»¥åµŒå¥—ç»“æ„ä½“ï¼š

</div>

```rust
use serde::Deserialize;
use confers::Config;

#[derive(Config, Deserialize)]
struct DatabaseConfig {
    #[config(default = "\"localhost\".to_string()")]
    host: String,
    #[config(default = "5432")]
    port: u16,
}

#[derive(Config, Deserialize)]
#[config(env_prefix = "MYAPP", strict = true)]
struct MyConfig {
    #[config(default = "100")]
    timeout_ms: u64,
    
    // åµŒå¥—ç»“æ„ä½“
    db: DatabaseConfig,
    
    #[config(sensitive = true)] // åœ¨å®¡è®¡æ—¥å¿—ä¸­ä¼šè¢«è„±æ•
    api_key: String,
}
```

### åŠ è½½é…ç½®

`confers` æä¾›äº†å¤šç§åŒæ­¥å’Œå¼‚æ­¥åŠ è½½æ–¹æ³•ï¼Œå¹¶æ”¯æŒè®¾ç½®å†…å­˜é™åˆ¶å’Œè‡ªå®šä¹‰æ¸…æ´—é€»è¾‘ï¼š

```rust
let config = MyConfig::new_loader()
    .with_file("custom.yaml")
    .with_memory_limit(10)
    .load()
    .await?;

// å¼‚æ­¥åŠ è½½ï¼ˆé€‚ç”¨äºè¿œç¨‹é…ç½®ï¼‰
let config = MyConfig::load().await?;
```

### é»˜è®¤å€¼ä¸ç¯å¢ƒå˜é‡

- **é»˜è®¤å€¼**: ä½¿ç”¨ `#[config(default = "...")]`ã€‚æ³¨æ„å­—ç¬¦ä¸²éœ€è¦åŒå¼•å·è½¬ä¹‰ã€‚
- **ç¯å¢ƒå˜é‡**: é»˜è®¤æ˜ å°„è§„åˆ™ä¸º `PREFIX_FIELD_NAME`ã€‚ä¾‹å¦‚ `MYAPP_TIMEOUT_MS` æ˜ å°„åˆ° `timeout_ms`ã€‚

---

## é«˜çº§ç”¨æ³•

### éªŒè¯ä¸æ¸…æ´—

`confers` é›†æˆäº† `validator` åº“ï¼Œå…è®¸ä½ åœ¨åŠ è½½é…ç½®æ—¶è¿›è¡Œè‡ªåŠ¨éªŒè¯ï¼š

```rust
use validator::Validate;

#[derive(Config, Deserialize, Validate)]
#[config(validate)] // å¯ç”¨è‡ªåŠ¨éªŒè¯
struct MyConfig {
    #[validate(range(min = 1, max = 65535))]
    port: u16,
    
    #[validate(email)]
    admin_email: String,
}
```

ä½ è¿˜å¯ä»¥å®šä¹‰è‡ªå®šä¹‰çš„ `sanitizer` æ¥æ¸…æ´—æ•°æ®ï¼ˆä¾‹å¦‚å»é™¤é¦–å°¾ç©ºæ ¼ï¼‰ï¼š

```rust
let config = MyConfig::new_loader()
    .with_sanitizer(|mut cfg| {
        cfg.admin_email = cfg.admin_email.trim().to_lowercase();
        Ok(cfg)
    })
    .load()
    .await?;
```

### è¿œç¨‹é…ç½® (Etcd/Consul/HTTP)

<div style="padding:16px; margin: 16px 0">

âš ï¸ **æ³¨æ„**: ä»¥ä¸‹åŠŸèƒ½éœ€è¦å¯ç”¨ `remote` ç‰¹æ€§ã€‚

</div>

é€šè¿‡å¯ç”¨ `remote` ç‰¹æ€§ï¼Œä½ å¯ä»¥ä»è¿œç¨‹æºåŠ è½½é…ç½®ã€‚`confers` æ”¯æŒèº«ä»½éªŒè¯å’Œ TLS åŠ å¯†ï¼š

```rust
// ä» Etcd åŠ è½½ï¼Œå¸¦èº«ä»½éªŒè¯å’Œ TLS
let config = MyConfig::new_loader()
    .with_remote_url("http://localhost:2379")
    .with_remote_auth("admin", "password")
    .with_remote_tls("ca.crt", "client.crt", "client.key")
    .load()
    .await?;

// ä» Consul åŠ è½½é…ç½®
let config = MyConfig::new_loader()
    .with_remote_url("consul://localhost:8500")
    .with_remote_token("your-consul-token")
    .load()
    .await?;

// ä» HTTP æ¥å£åŠ è½½ï¼Œå¸¦ Bearer Token
let config = MyConfig::new_loader()
    .with_remote("https://api.example.com/config")
    .with_remote_token("your-token")
    .load()
    .await?;
```

### å®¡è®¡æ—¥å¿—ä¸å®‰å…¨

<div style="padding:16px; margin: 16px 0">

ğŸ“ **æç¤º**: ä»¥ä¸‹åŠŸèƒ½éœ€è¦å¯ç”¨ `audit` ç‰¹æ€§ã€‚

</div>

å¯ç”¨ `audit` ç‰¹æ€§åï¼Œ`confers` å¯ä»¥è®°å½•é…ç½®åŠ è½½çš„å†å²ï¼Œå¹¶è‡ªåŠ¨å¯¹æ•æ„Ÿå­—æ®µè¿›è¡Œè„±æ•ã€‚ä½ è¿˜å¯ä»¥é™åˆ¶åŠ è½½è¿‡ç¨‹ä¸­çš„å†…å­˜å ç”¨ï¼š

```rust
#[derive(Config, Deserialize)]
#[config(audit)] // å¯ç”¨å®¡è®¡
struct SecureConfig {
    #[config(sensitive = true)]
    db_password: String,
}

// åŠ è½½æ—¶ä¼šè‡ªåŠ¨è¾“å‡ºå®¡è®¡æ—¥å¿—ï¼Œå¹¶é™åˆ¶å†…å­˜ä½¿ç”¨ä»¥é˜²æ­¢ OOM
let config = SecureConfig::new_loader()
    .with_audit_log(true)
    .with_audit_log_path("audit.log")
    .with_memory_limit(50) // é™åˆ¶ä¸º 50MB
    .load()
    .await?;
```

### æ–‡ä»¶ç›‘å¬ä¸çƒ­é‡è½½

<div style="padding:16px; margin: 16px 0">

âœ¨ **æç¤º**: ä»¥ä¸‹åŠŸèƒ½éœ€è¦å¯ç”¨ `watch` ç‰¹æ€§ã€‚

</div>

`confers` æ”¯æŒç›‘å¬é…ç½®æ–‡ä»¶æˆ–è¿œç¨‹æºçš„å˜åŒ–ã€‚å¯ç”¨ `watch` ç‰¹æ€§åï¼Œä½ å¯ä»¥æ‰‹åŠ¨æ£€æŸ¥é…ç½®æ–‡ä»¶çš„å˜åŒ–å¹¶é‡æ–°åŠ è½½ï¼š

```rust
use std::time::Duration;

// å¯ç”¨ç›‘å¬åŠŸèƒ½
let config = MyConfig::new_loader()
    .with_file("config.toml")
    .with_watch(true)
    .load()
    .await?;

println!("åˆå§‹é…ç½®å·²åŠ è½½ï¼Œæ¶ˆæ¯: {}", config.message);

// ç›‘æ§å˜åŒ–å¾ªç¯
let mut last_message = config.message.clone();

for i in 1..=5 {
    println!("\n[è¿­ä»£ {}] è¯·ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶ç­‰å¾…...", i);

    // æ¨¡æ‹Ÿå¤–éƒ¨å˜æ›´
    std::thread::sleep(Duration::from_millis(500));

    // æ£€æŸ¥æ˜¯å¦å‘ç”Ÿå˜åŒ–
    let current_config = MyConfig::new_loader()
        .with_file("config.toml")
        .load()
        .await?;
    
    if current_config.message != last_message {
        println!(">>> é…ç½®å·²å˜æ›´ï¼æ–°æ¶ˆæ¯: {}", current_config.message);
        last_message = current_config.message.clone();
    } else {
        println!("å°šæœªæ£€æµ‹åˆ°å˜æ›´...");
    }
}
```

### é…ç½®å·®åˆ†å¯¹æ¯”

ä½¿ç”¨ `confers` çš„é…ç½®å·®åˆ†åŠŸèƒ½ï¼Œå¯ä»¥æ¯”è¾ƒä¸åŒç¯å¢ƒæˆ–ç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶å·®å¼‚ï¼š

```rust
use confers::ConfigDiff;

// æ¯”è¾ƒä¸¤ä¸ªé…ç½®æ–‡ä»¶
let diff = ConfigDiff::new("development.toml", "production.toml")?;

// ä½¿ç”¨ç»Ÿä¸€æ ¼å¼è¾“å‡º
diff.print_unified_diff()?;

// ä½¿ç”¨å¹¶æ’æ ¼å¼è¾“å‡º
diff.print_side_by_side_diff()?;

// ç”Ÿæˆå·®å¼‚æŠ¥å‘Š
diff.generate_report("diff_report.md")?;
```

**å‘½ä»¤è¡Œæ–¹å¼ï¼š**

```bash
# ä½¿ç”¨ CLI è¿›è¡Œé…ç½®å·®åˆ†
confers diff development.toml production.toml --format unified -o diff_report.md
```

### æ•æ„Ÿæ•°æ®åŠ å¯†

`confers` ä½¿ç”¨ AES-256 åŠ å¯†ç®—æ³•ä¿æŠ¤æ•æ„Ÿé…ç½®ä¿¡æ¯ï¼š

```rust
use confers::{ConfigEncrypt, EncryptedConfig};

// ç”ŸæˆåŠ å¯†å¯†é’¥
let key = ConfigEncrypt::generate_key()?;

// åŠ å¯†æ•æ„Ÿé…ç½®
let encrypted = ConfigEncrypt::encrypt_value(
    "super_secret_password",
    &key
)?;

// è§£å¯†é…ç½®
let decrypted = ConfigEncrypt::decrypt_value(
    &encrypted,
    &key
)?;
```

**å‘½ä»¤è¡Œæ–¹å¼ï¼š**

```bash
# ç”Ÿæˆå¯†é’¥
confers key -o encryption.key

# åŠ å¯†é…ç½®æ–‡ä»¶
confers encrypt config.toml --key-file encryption.key -o config.encrypted.toml

# è§£å¯†é…ç½®æ–‡ä»¶
confers encrypt config.encrypted.toml --key-file encryption.key --decrypt -o config.toml
```

---

## æœ€ä½³å®è·µ

<div align="center" style="margin: 24px 0">

### ğŸŒŸ æ¨èçš„è®¾è®¡æ¨¡å¼

</div>

<table style="width:100%; border-collapse: collapse">
<tr>
<td width="50%" style="padding: 16px">

### âœ… æ¨èåšæ³•

- **åˆ†å±‚é…ç½®**: å°†é…ç½®æ‹†åˆ†ä¸ºå¤šä¸ªå°ç»“æ„ä½“ï¼ˆå¦‚ `DatabaseConfig`, `ServerConfig`ï¼‰ï¼Œç„¶åç»„åˆè¿› `AppConfig`ã€‚
- **ç¯å¢ƒéš”ç¦»**: ä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ `env_prefix`ï¼ˆå¦‚ `DEV_`, `PROD_`ï¼‰ã€‚
- **é˜²å¾¡æ€§åŠ è½½**: å§‹ç»ˆä¸ºå¯é€‰å­—æ®µä½¿ç”¨ `Option<T>`ï¼Œå¹¶ä¸ºå…³é”®å­—æ®µæä¾› `default` å€¼ã€‚
- **éªŒè¯ä¸æ¸…æ´—**: å§‹ç»ˆå¯ç”¨ `validate` å±æ€§ï¼Œå¹¶ä½¿ç”¨ `with_sanitizer` æ¸…ç†è¾“å…¥ï¼ˆå¦‚å»é™¤å­—ç¬¦ä¸²é¦–å°¾ç©ºæ ¼ï¼‰ã€‚
- **å®‰å…¨æ€§**: æ•æ„Ÿå­—æ®µæ ‡è®° `sensitive = true` ä»¥é˜²å®¡è®¡æ—¥å¿—æ³„éœ²ã€‚

</td>
<td width="50%" style="padding: 16px">

### âŒ é¿å…åšæ³•

- **å…¨å±€é™æ€å˜é‡**: å°½é‡é¿å…ä½¿ç”¨å…¨å±€ `static` å­˜å‚¨é…ç½®ï¼Œæ¨èé€šè¿‡ä¾èµ–æ³¨å…¥æˆ– `Arc` ä¼ é€’é…ç½®ã€‚
- **å¿½ç•¥é”™è¯¯**: ç”Ÿäº§ç¯å¢ƒåº”ä¸¥æ ¼æ£€æŸ¥ `ConfigError`ï¼Œç‰¹åˆ«æ˜¯ `MemoryLimitExceeded` å’Œ `ValidationError`ã€‚
- **ç¡¬ç¼–ç **: ä»»ä½•å¯èƒ½éšç¯å¢ƒå˜åŒ–çš„å‚æ•°éƒ½åº”é€šè¿‡é…ç½®ç®¡ç†ï¼Œè€Œéç¡¬ç¼–ç ã€‚
- **æ•æ„Ÿä¿¡æ¯æ˜æ–‡å­˜å‚¨**: æ•æ„Ÿé…ç½®åº”ä½¿ç”¨åŠ å¯†åŠŸèƒ½ä¿æŠ¤ã€‚

</td>
</tr>
</table>

---

## æ•…éšœæ’é™¤

<div style="padding:16px; margin: 16px 0">

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| **â“ ç¯å¢ƒå˜é‡æ²¡æœ‰ç”Ÿæ•ˆ** | 1. æ£€æŸ¥ `#[config(env_prefix = "APP")]` æ˜¯å¦æ­£ç¡®è®¾ç½®ã€‚<br>2. ç¯å¢ƒå˜é‡ååº”ä¸º `PREFIX_FIELD_NAME`ï¼ˆå…¨å¤§å†™ï¼‰ã€‚<br>3. å¯¹äºåµŒå¥—ç»“æ„ä½“ï¼Œä½¿ç”¨åŒä¸‹åˆ’çº¿ï¼Œä¾‹å¦‚ `APP_DB__HOST` æ˜ å°„åˆ° `db.host`ã€‚ |
| **â“ åŠ è½½æ—¶æŠ¥ MemoryLimitExceeded é”™è¯¯** | 1. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦è¿‡å¤§ï¼Œæˆ–è€…æ˜¯å¦å­˜åœ¨å¾ªç¯å¼•ç”¨çš„é…ç½®ã€‚<br>2. è°ƒå¤§ `with_memory_limit(mb)` çš„é˜ˆå€¼ï¼ˆé»˜è®¤ä¸é™åˆ¶ï¼‰ã€‚ |
| **â“ éªŒè¯å¤±è´¥ ValidationError** | 1. æ£€æŸ¥ `validator` çš„çº¦æŸé€»è¾‘ã€‚`confers` ä¼šåœ¨åŠ è½½åç«‹å³è¿è¡ŒéªŒè¯ã€‚<br>2. æŸ¥çœ‹é”™è¯¯è¾“å‡ºï¼Œå®ƒä¼šæŒ‡æ˜å“ªä¸ªå­—æ®µæœªæ»¡è¶³å“ªä¸ªçº¦æŸã€‚ |
| **â“ è¿œç¨‹é…ç½®åŠ è½½å¤±è´¥ RemoteError** | 1. æ£€æŸ¥ç½‘ç»œè¿æ¥åŠ URL æ˜¯å¦æ­£ç¡®ã€‚<br>2. å¦‚æœå¯ç”¨äº† TLSï¼Œç¡®ä¿è¯ä¹¦è·¯å¾„æ­£ç¡®ä¸”æœ‰æ•ˆã€‚<br>3. æ£€æŸ¥èº«ä»½éªŒè¯ä»¤ç‰Œæˆ–ç”¨æˆ·åå¯†ç æ˜¯å¦è¿‡æœŸã€‚ |

</div>

<div align="center" style="margin: 24px 0">

**ğŸ’¬ ä»ç„¶éœ€è¦å¸®åŠ©ï¼Ÿ** [æäº¤ Issue](https://github.com/Kirky-X/confers/issues) æˆ– [è®¿é—®æ–‡æ¡£ä¸­å¿ƒ](https://github.com/project/confers)

</div>

---

## åç»­æ­¥éª¤

<div align="center" style="margin: 24px 0">

### ğŸ¯ ç»§ç»­æ¢ç´¢

</div>

<table style="width:100%; border-collapse: collapse">
<tr>
<td align="center" width="33%" style="padding: 16px">
<a href="API_REFERENCE.md">
<div style="padding: 24px; transition: transform 0.2s">
<img src="https://img.icons8.com/fluency/96/000000/graduation-cap.png" width="48" height="48"><br>
<b style="color:#1E293B">ğŸ“š API å‚è€ƒ</b>
</div>
</a>
<br><span style="color:#64748B">è¯¦ç»†çš„æ¥å£è¯´æ˜</span>
</td>
<td align="center" width="33%" style="padding: 16px">
<a href="ARCHITECTURE.md">
<div style="padding: 24px; transition: transform 0.2s">
<img src="https://img.icons8.com/fluency/96/000000/settings.png" width="48" height="48"><br>
<b style="color:#1E293B">ğŸ”§ æ¶æ„è®¾è®¡</b>
</div>
</a>
<br><span style="color:#64748B">æ·±å…¥äº†è§£å†…éƒ¨æœºåˆ¶</span>
</td>
<td align="center" width="33%" style="padding: 16px">
<a href="../examples/">
<div style="padding: 24px; transition: transform 0.2s">
<img src="https://img.icons8.com/fluency/96/000000/code.png" width="48" height="48"><br>
<b style="color:#1E293B">ğŸ’» ç¤ºä¾‹ä»£ç </b>
</div>
</a>
<br><span style="color:#64748B">çœŸå®åœºæ™¯çš„ä»£ç æ ·ä¾‹</span>
</td>
</tr>
</table>

---

<div align="center" style="margin: 32px 0; padding: 24px">

**[ğŸ“– API æ–‡æ¡£](https://docs.rs/confers)** â€¢ **[â“ å¸¸è§é—®é¢˜](FAQ.md)** â€¢ **[ğŸ› æŠ¥å‘Šé—®é¢˜](https://github.com/Kirky-X/confers/issues)**

**ç”± Kirky.X ç”¨ â¤ï¸ åˆ¶ä½œ**

**[â¬† è¿”å›é¡¶éƒ¨](#top)**

</div>
