<span id="top"></span>
<div align="center">

<img src="image/confers.png" alt="Confers Logo" width="150" style="margin-bottom: 16px">

# ğŸ“– ç”¨æˆ·æŒ‡å—

[ğŸ  é¦–é¡µ](../README.md) â€¢ [ğŸ“š æ–‡æ¡£](../README.md) â€¢ [ğŸ¯ ç¤ºä¾‹](../examples/) â€¢ [â“ å¸¸è§é—®é¢˜](FAQ.md)

---

</div>

## ğŸ“‹ ç›®å½•

<details open style="padding:16px">
<summary style="cursor:pointer; font-weight:600; color:#1E293B">ğŸ“‘ ç›®å½•ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>

- [ç®€ä»‹](#ç®€ä»‹)
- [å¿«é€Ÿå…¥é—¨](#å¿«é€Ÿå…¥é—¨)
  - [å…ˆå†³æ¡ä»¶](#å…ˆå†³æ¡ä»¶)
  - [å®‰è£…](#å®‰è£…)
  - [ç¬¬ä¸€æ­¥](#ç¬¬ä¸€æ­¥)
- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [å‘½ä»¤è¡Œå·¥å…·](#å‘½ä»¤è¡Œå·¥å…·)
- [åŸºç¡€ç”¨æ³•](#åŸºç¡€ç”¨æ³•)
- [é«˜çº§ç”¨æ³•](#é«˜çº§ç”¨æ³•)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [åç»­æ­¥éª¤](#åç»­æ­¥éª¤)

</details>

---

## ç®€ä»‹

<div align="center" style="margin: 24px 0">

### ğŸ¯ ä½ å°†å­¦åˆ°ä»€ä¹ˆ

</div>

<table style="width:100%; border-collapse: collapse">
<tr>
<td align="center" width="25%" style="padding: 16px">
<img src="https://img.icons8.com/fluency/96/000000/rocket.png" width="48" height="48"><br>
<b style="color:#166534">å¿«é€Ÿå…¥é—¨</b><br>
<span style="color:#166534">5 åˆ†é’Ÿå†…å®Œæˆç¯å¢ƒæ­å»º</span>
</td>
<td align="center" width="25%" style="padding: 16px">
<img src="https://img.icons8.com/fluency/96/000000/settings.png" width="48" height="48"><br>
<b style="color:#1E40AF">çµæ´»é…ç½®</b><br>
<span style="color:#1E40AF">æ”¯æŒå¤šç§æºä¸æ ¼å¼</span>
</td>
<td align="center" width="25%" style="padding: 16px">
<img src="https://img.icons8.com/fluency/96/000000/code.png" width="48" height="48"><br>
<b style="color:#92400E">æœ€ä½³å®è·µ</b><br>
<span style="color:#92400E">å­¦ä¹ è§„èŒƒçš„é…ç½®ç®¡ç†</span>
</td>
<td align="center" width="25%" style="padding: 16px">
<img src="https://img.icons8.com/fluency/96/000000/rocket-take-off.png" width="48" height="48"><br>
<b style="color:#5B21B6">é«˜çº§ç‰¹æ€§</b><br>
<span style="color:#5B21B6">æŒæ¡çƒ­é‡è½½ä¸è¿œç¨‹é…ç½®</span>
</td>
</tr>
</table>

**confers** æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Rust é…ç½®ç®¡ç†åº“ï¼Œæ—¨åœ¨ç®€åŒ–åº”ç”¨ç¨‹åºçš„é…ç½®åŠ è½½ã€éªŒè¯å’Œç®¡ç†ã€‚å®ƒæ”¯æŒä»æ–‡ä»¶ï¼ˆJSON, TOML, YAMLï¼‰ã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°ä»¥åŠè¿œç¨‹æºï¼ˆEtcd, HTTPï¼‰åŠ è½½é…ç½®ã€‚

<div style="padding:16px; margin: 16px 0">> ğŸ’¡ **æç¤º**: æœ¬æŒ‡å—å‡è®¾ä½ å…·å¤‡åŸºæœ¬çš„ Rust çŸ¥è¯†ã€‚å¦‚æœä½ æ˜¯ Rust æ–°æ‰‹ï¼Œå»ºè®®å…ˆé˜…è¯» [Rust å®˜æ–¹æ•™ç¨‹](https://doc.rust-lang.org/book/)ã€‚

</div>

---

## å¿«é€Ÿå…¥é—¨

### å…ˆå†³æ¡ä»¶

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š

<table style="width:100%; border-collapse: collapse">
<tr>
<td width="50%" style="padding: 16px">

**å¿…é€‰**
- âœ… Rust 1.75+ (stable)
- âœ… Cargo (éš Rust ä¸€èµ·å®‰è£…)
- âœ… Git

</td>
<td width="50%" style="padding: 16px">

**å¯é€‰**
- ğŸ”§ æ”¯æŒ Rust çš„ IDE (å¦‚ VS Code + rust-analyzer)
- ğŸ”§ Docker (ç”¨äºå®¹å™¨åŒ–éƒ¨ç½²)
- ğŸ”§ Etcd (ç”¨äºè¿œç¨‹é…ç½®æµ‹è¯•)

</td>
</tr>
</table>

<details style="padding:16px; margin: 16px 0">
<summary style="cursor:pointer; font-weight:600; color:#1E293B">ğŸ” éªŒè¯å®‰è£…</summary>

```bash
# æ£€æŸ¥ Rust ç‰ˆæœ¬
rustc --version
# é¢„æœŸ: rustc 1.75.0 (æˆ–æ›´é«˜)

# æ£€æŸ¥ Cargo ç‰ˆæœ¬
cargo --version
# é¢„æœŸ: cargo 1.75.0 (æˆ–æ›´é«˜)
```

</details>

### å®‰è£…

åœ¨ä½ çš„ `Cargo.toml` ä¸­æ·»åŠ  `confers`ï¼š

<div style="padding:16px; margin: 16px 0">

| å®‰è£…ç±»å‹ | é…ç½® | ä½¿ç”¨åœºæ™¯ |
|----------|------|----------|
| **é»˜è®¤** | `confers = "0.2.0"` | åŒ…å« deriveã€validation å’Œ CLI |
| **æœ€å°åŒ–** | `confers = { version = "0.2.0", default-features = false, features = ["minimal"] }` | ä»…é…ç½®åŠ è½½ |
| **æ¨è** | `confers = { version = "0.2.0", default-features = false, features = ["recommended"] }` | é…ç½® + éªŒè¯ |
| **å®Œæ•´** | `confers = { version = "0.2.0", features = ["full"] }` | æ‰€æœ‰åŠŸèƒ½ |

**å¯ç”¨ç‰¹æ€§é¢„è®¾ï¼š**

| é¢„è®¾ | ç‰¹æ€§ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| <span style="color:#166534; padding:4px 8px">minimal</span> | `derive` | ä»…é…ç½®åŠ è½½ |
| <span style="color:#1E40AF; padding:4px 8px">recommended</span> | `derive`, `validation` | é…ç½®åŠ è½½ + éªŒè¯ |
| <span style="color:#92400E; padding:4px 8px">dev</span> | `derive`, `validation`, `cli`, `schema`, `audit`, `monitoring` | å¼€å‘é…ç½® |
| <span style="color:#991B1B; padding:4px 8px">production</span> | `derive`, `validation`, `watch`, `encryption`, `remote`, `monitoring` | ç”Ÿäº§é…ç½® |
| <span style="color:#5B21B6; padding:4px 8px">full</span> | æ‰€æœ‰ç‰¹æ€§ | å®Œæ•´åŠŸèƒ½é›† |

**å•ç‹¬ç‰¹æ€§ï¼š**

| ç‰¹æ€§ | æè¿° | é»˜è®¤ |
|------|------|------|
| `derive` | é…ç½®ç»“æ„ä½“çš„ derive å® | âœ… |
| `validation` | é…ç½®éªŒè¯æ”¯æŒ | âœ… |
| `cli` | å‘½ä»¤è¡Œå·¥å…· | âŒ |
| `watch` | æ–‡ä»¶ç›‘æ§å’Œçƒ­é‡è½½ | âŒ |
| `audit` | å®¡è®¡æ—¥å¿— | âŒ |
| `schema` | JSON Schema ç”Ÿæˆ | âŒ |
| `parallel` | å¹¶è¡ŒéªŒè¯ | âŒ |
| `monitoring` | ç³»ç»Ÿç›‘æ§ | âŒ |
| `remote` | è¿œç¨‹é…ç½®ï¼ˆetcdã€consulã€httpï¼‰ | âŒ |
| `encryption` | é…ç½®åŠ å¯† | âŒ |

</div>

å¦‚æœéœ€è¦å¼‚æ­¥/è¿œç¨‹æ”¯æŒï¼Œæ·»åŠ  tokioï¼š
```toml
[dependencies]
tokio = { version = "1.0", features = ["full"] }
```

### ç¬¬ä¸€æ­¥

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥éªŒè¯å®‰è£…ã€‚æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªåŒ…å«é»˜è®¤å€¼å’Œç¯å¢ƒå˜é‡æ˜ å°„çš„é…ç½®ç»“æ„ä½“ï¼š

```rust
use confers::Config;
use serde::{Deserialize, Serialize};

#[derive(Debug, Serialize, Deserialize, Config)]
#[config(env_prefix = "APP")]
struct AppConfig {
    #[config(default = "8080")]
    port: u16,
    
    #[config(default = "\"localhost\".to_string()")]
    host: String,
}

fn main() -> Result<(), Box<dyn std::error::Error>> {
    // åŠ è½½é…ç½®ï¼ˆåŒæ­¥æ–¹å¼ï¼ŒæŒ‰é¡ºåºï¼šé»˜è®¤å€¼ -> é…ç½®æ–‡ä»¶ -> ç¯å¢ƒå˜é‡ï¼‰
    let config = AppConfig::new_loader()
        .load_sync()?;
    
    println!("ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨: {}:{}", config.host, config.port);
    Ok(())
}

// æˆ–è€…ä½¿ç”¨å¼‚æ­¥æ–¹å¼ï¼ˆé€‚ç”¨äºè¿œç¨‹é…ç½®ï¼‰
#[tokio::main]
async fn async_main() -> Result<(), Box<dyn std::error::Error>> {
    let config = AppConfig::new_loader()
        .load()
        .await?;
    
    println!("ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨: {}:{}", config.host, config.port);
    Ok(())
}
```

**æ³¨æ„ï¼š** `Config` trait é€šè¿‡å®è‡ªåŠ¨å®ç°ï¼Œå®é™…çš„åŠ è½½æ–¹æ³•é€šè¿‡ `ConfigLoader` æä¾›ï¼š
- `load_sync()` - åŒæ­¥åŠ è½½
- `load()` - å¼‚æ­¥åŠ è½½ï¼ˆé€‚ç”¨äºè¿œç¨‹é…ç½®ï¼‰
- `load_sync_with_audit()` - å¸¦å®¡è®¡æ—¥å¿—çš„åŒæ­¥åŠ è½½
- `load_sync_with_watcher()` - å¸¦æ–‡ä»¶ç›‘æ§çš„åŒæ­¥åŠ è½½

---

## æ ¸å¿ƒæ¦‚å¿µ

ç†è§£è¿™äº›æ ¸å¿ƒæ¦‚å¿µå°†å¸®åŠ©ä½ æ›´æœ‰æ•ˆåœ°ä½¿ç”¨ `confers`ã€‚

<div align="center" style="margin: 24px 0">

### ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

</div>

```mermaid
graph TB
    subgraph Sources ["ğŸ“¥ é…ç½®æ¥æº"]
        A[ğŸ“ é…ç½®æ–‡ä»¶<br/>JSON, TOML, YAML]
        B[ğŸŒ ç¯å¢ƒå˜é‡]
        C[ğŸ’» CLI å‚æ•°]
        D[â˜ï¸ è¿œç¨‹æº<br/>Etcd, Consul, HTTP]
    end
    
    subgraph Priority ["ğŸ“Š ä¼˜å…ˆçº§ï¼ˆé«˜â†’ä½ï¼‰"]
        P1["ğŸ’» CLI å‚æ•°<br/>æœ€é«˜ä¼˜å…ˆçº§"]
        P2["ğŸŒ ç¯å¢ƒå˜é‡"]
        P3["ğŸ“ é…ç½®æ–‡ä»¶"]
        P4["ğŸ”§ é»˜è®¤å€¼<br/>æœ€ä½ä¼˜å…ˆçº§"]
    end
    
    subgraph Result ["ğŸ“¤ ç»“æœ"]
        R[ğŸš€ ç±»å‹å®‰å…¨é…ç½®]
    end
    
    Sources --> Priority
    Priority --> R
    
    style Sources fill:#DBEAFE,stroke:#1E40AF
    style Priority fill:#FEF3C7,stroke:#92400E
    style Result fill:#DCFCE7,stroke:#166534
```

### 1ï¸âƒ£ `Config` æ´¾ç”Ÿå®

`confers` çš„æ ¸å¿ƒæ˜¯ `Config` æ´¾ç”Ÿå®ã€‚å®ƒä¼šè‡ªåŠ¨ä¸ºä½ çš„ç»“æ„ä½“å®ç°é…ç½®åŠ è½½é€»è¾‘ï¼ŒåŒ…æ‹¬å¤„ç†é»˜è®¤å€¼ã€ç¯å¢ƒå˜é‡å‰ç¼€å’ŒéªŒè¯è§„åˆ™ã€‚

### 2ï¸âƒ£ å±‚æ¬¡åŒ–åŠ è½½

`confers` éµå¾ª"æœ€åå®šä¹‰çš„èƒœå‡º"åŸåˆ™ï¼ŒæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§åˆå¹¶é…ç½®ï¼š
1. **å‘½ä»¤è¡Œå‚æ•°** (æœ€é«˜ä¼˜å…ˆçº§)
2. **ç¯å¢ƒå˜é‡**
3. **é…ç½®æ–‡ä»¶** (å¦‚ `config.toml`)
4. **é»˜è®¤å€¼** (æœ€ä½ä¼˜å…ˆçº§)

### 3ï¸âƒ£ çµæ´»çš„æ•°æ®æº

ä½ å¯ä»¥è½»æ¾åœ°ä»ä¸åŒæ¥æºç»„åˆé…ç½®ï¼š
- **æ–‡ä»¶**: æ”¯æŒè‡ªåŠ¨æ£€æµ‹ JSON, TOML, YAML æ ¼å¼ã€‚
- **ç¯å¢ƒ**: é€šè¿‡ `env_prefix` è‡ªåŠ¨æ˜ å°„ç¯å¢ƒå˜é‡ã€‚
- **è¿œç¨‹**: æ”¯æŒ Etcdã€Consul å’Œ HTTP è½®è¯¢/ç›‘å¬ã€‚

### 4ï¸âƒ£ é…ç½®æ–‡ä»¶æœç´¢è·¯å¾„

`confers` æ”¯æŒçµæ´»çš„æ–‡ä»¶æœç´¢ç­–ç•¥ï¼Œå¯ä»¥æ ¹æ®ä½ çš„éœ€æ±‚åœ¨ä¸åŒä½ç½®æŸ¥æ‰¾é…ç½®æ–‡ä»¶ã€‚

#### é»˜è®¤æœç´¢è·¯å¾„

å½“ä½ ä½¿ç”¨ `Config::load()` æˆ– `Config::create_loader()` æ—¶ï¼Œ`confers` ä¼šåœ¨ä»¥ä¸‹ä½ç½®æŒ‰ä¼˜å…ˆçº§æœç´¢é…ç½®æ–‡ä»¶ï¼š

| ä¼˜å…ˆçº§ | æœç´¢è·¯å¾„ | æ¡ä»¶ | æ–‡ä»¶æ ¼å¼ |
|--------|----------|------|----------|
| 1 | `./` | æ€»æ˜¯ | `config.{toml,json,yaml,yml}` |
| 2 | `~/.config/<app_name>/` | è®¾ç½® `app_name` | `config.{toml,json,yaml,yml}` |
| 3 | `~/.config/` | æ€»æ˜¯ | `config.{toml,json,yaml,yml}` |
| 4 | `~/` | æ€»æ˜¯ | `config.{toml,json,yaml,yml}` |
| 5 | `/etc/<app_name>/` | Unix + è®¾ç½® `app_name` | `config.{toml,json,yaml,yml}` |

#### app_name çš„ä½œç”¨

`app_name` æ˜¯ä¸€ä¸ªå¯é€‰çš„åº”ç”¨æ ‡è¯†ç¬¦ï¼Œç”¨äºåœ¨æ ‡å‡†ç³»ç»Ÿç›®å½•ä¸­ç»„ç»‡é…ç½®æ–‡ä»¶ï¼š

```rust
#[derive(Debug, Serialize, Deserialize, Config)]
#[config(app_name = "myapp")]  // âœ… æ˜¾å¼è®¾ç½® app_name
pub struct AppConfig {
    pub host: String,
    pub port: u16,
}
```

**è®¾ç½® app_name åçš„æœç´¢è·¯å¾„**ï¼š
```
./myapp/config.toml              âœ…
~/.config/myapp/config.toml      âœ…
~/.config/config.toml            âœ…
~/config.toml                    âœ…
/etc/myapp/config.toml           âœ… (Unix)
./config.toml                    âŒ (ä¸å†æœç´¢)
```

**ä¸è®¾ç½® app_name æ—¶çš„æœç´¢è·¯å¾„**ï¼š
```
./config.toml                    âœ…
~/.config/config.toml            âœ…
~/config.toml                    âœ…
```

#### é…ç½®æ–‡ä»¶å‘½åè§„åˆ™

`confers` æ”¯æŒä»¥ä¸‹é…ç½®æ–‡ä»¶å‘½åæ¨¡å¼ï¼š

```bash
# æ ‡å‡†é…ç½®æ–‡ä»¶
config.toml
config.json
config.yaml
config.yml

# ç¯å¢ƒç‰¹å®šé…ç½®æ–‡ä»¶ (å½“è®¾ç½® RUN_ENV ç¯å¢ƒå˜é‡æ—¶)
<app_name>.<env>.toml
# ä¾‹å¦‚: myapp.production.toml, myapp.development.json
```

#### ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

**åœºæ™¯1ï¼šåº”ç”¨ç¨‹åºä½¿ç”¨æ ‡å‡†ç›®å½•**
```rust
#[derive(Config)]
#[config(app_name = "my-awesome-app")]
pub struct ProductionConfig {
    pub database_url: String,
    pub max_connections: u32,
}
// é…ç½®æ–‡ä»¶ä½äº: ~/.config/my-awesome-app/config.toml
```

**åœºæ™¯2ï¼šç®€å•åº”ç”¨ä½¿ç”¨å½“å‰ç›®å½•**
```rust
#[derive(Config)]
pub struct SimpleConfig {
    pub debug: bool,
    pub workers: usize,
}
// é…ç½®æ–‡ä»¶ä½äº: ./config.toml (æ¨èç®€å•åº”ç”¨ä½¿ç”¨)
```

**åœºæ™¯3ï¼šæŒ‡å®šç²¾ç¡®è·¯å¾„**
```rust
#[derive(Config)]
pub struct AppConfig {
    pub name: String,
}

// ä½¿ç”¨ load_file() æŒ‡å®šç²¾ç¡®è·¯å¾„
let config = AppConfig::load_file("/etc/myapp/production.toml")
    .load_sync()?;
```

**åœºæ™¯4ï¼šç¯å¢ƒç‰¹å®šé…ç½®**
```bash
# è®¾ç½®è¿è¡Œç¯å¢ƒ
export RUN_ENV=production

# confers ä¼šè‡ªåŠ¨æœç´¢:
# ./myapp.production.toml
# ~/.config/myapp.production.toml
# /etc/myapp.production.toml (Unix)
```

#### æœ€ä½³å®è·µå»ºè®®

1. **åº”ç”¨ç¨‹åº**ï¼šæ¨èè®¾ç½® `app_name` ä»¥ä½¿ç”¨æ ‡å‡†ç³»ç»Ÿç›®å½•
   ```rust
   #[config(app_name = "your-app-name")]
   ```

2. **åº“/å·¥å…·**ï¼šä½¿ç”¨é»˜è®¤è¡Œä¸ºï¼Œåœ¨å½“å‰ç›®å½•æŸ¥æ‰¾ `config.toml`

3. **æµ‹è¯•/ç‰¹æ®Šéœ€æ±‚**ï¼šä½¿ç”¨ `load_file()` æŒ‡å®šç²¾ç¡®è·¯å¾„

4. **è·¨å¹³å°åº”ç”¨**ï¼šè®¾ç½® `app_name` ä»¥è·å¾—æœ€ä½³çš„è·¨å¹³å°å…¼å®¹æ€§

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœé…ç½®æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œ`confers` ä¼šä½¿ç”¨é»˜è®¤å€¼å¹¶ç»§ç»­åŠ è½½ï¼ˆé™¤éå¯ç”¨ä¸¥æ ¼æ¨¡å¼ï¼‰ã€‚ä½¿ç”¨ `Config::load_file()` å¯ä»¥ç²¾ç¡®æ§åˆ¶é…ç½®æ–‡ä»¶è·¯å¾„ã€‚

---

## å‘½ä»¤è¡Œå·¥å…·

confers æä¾›äº†åŠŸèƒ½å®Œæ•´çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒé…ç½®æ–‡ä»¶çš„ç”Ÿæˆã€éªŒè¯ã€åŠ å¯†ã€å·®åˆ†ç­‰åŠŸèƒ½ã€‚

### å®‰è£… CLI

```bash
# ä»æºç å®‰è£…
cargo install confers

# æˆ–ä» crates.io å®‰è£…
cargo install confers-cli

# æŸ¥çœ‹ç‰ˆæœ¬
confers --version

# æŸ¥çœ‹å¸®åŠ©
confers --help
```

### å‘½ä»¤å‚è€ƒ

```bash
confers 0.2.0
A powerful Rust configuration management library

USAGE:
    confers [OPTIONS] <SUBCOMMAND>

OPTIONS:
    -h, --help         æ‰“å°å¸®åŠ©ä¿¡æ¯
    -V, --version      æ‰“å°ç‰ˆæœ¬ä¿¡æ¯
    -v, --verbose      å¯ç”¨è¯¦ç»†è¾“å‡º (-vv æ›´è¯¦ç»†)

SUBCOMMANDS:
    diff       æ¯”è¾ƒä¸¤ä¸ªé…ç½®æ–‡ä»¶çš„å·®å¼‚
    generate   ç”Ÿæˆé…ç½®æ¨¡æ¿
    validate   éªŒè¯é…ç½®æ–‡ä»¶
    encrypt    åŠ å¯†æ•æ„Ÿé…ç½®
    wizard     äº¤äº’å¼é…ç½®ç”Ÿæˆå‘å¯¼
    key        ç”Ÿæˆå’Œç®¡ç†åŠ å¯†å¯†é’¥
    help       æ‰“å°å¸®åŠ©ä¿¡æ¯
```

### diff - é…ç½®å·®åˆ†

<div style="padding:16px; margin: 16px 0">

æ¯”è¾ƒä¸¤ä¸ªé…ç½®æ–‡ä»¶çš„å·®å¼‚ï¼Œæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ï¼š

</div>

```bash
# åŸºæœ¬ç”¨æ³• - æ¯”è¾ƒä¸¤ä¸ªé…ç½®æ–‡ä»¶
confers diff config1.toml config2.toml

# æŒ‡å®šè¾“å‡ºæ ¼å¼
confers diff config1.toml config2.toml --format unified    # ç»Ÿä¸€ diff æ ¼å¼
confers diff config1.toml config2.toml --format context    # ä¸Šä¸‹æ–‡ diff æ ¼å¼
confers diff config1.toml config2.toml --format normal     # æ ‡å‡† diff æ ¼å¼
confers diff config1.toml config2.toml --format side-by-side  # å¹¶æ’å¯¹æ¯”æ ¼å¼
confers diff config1.toml config2.toml --format strict     # ä¸¥æ ¼æ¨¡å¼

# ç”ŸæˆæŠ¥å‘Š
confers diff config1.toml config2.toml -o diff_report.md

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers diff --help
```

**è¾“å‡ºæ ¼å¼è¯´æ˜ï¼š**

| æ ¼å¼ | æè¿° | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `unified` | ç»Ÿä¸€ diff æ ¼å¼ï¼Œå«è¡Œå·å’Œä¸Šä¸‹æ–‡ | ä»£ç å®¡æŸ¥ã€ç‰ˆæœ¬å¯¹æ¯” |
| `context` | ä¸Šä¸‹æ–‡ diff æ ¼å¼ | æŸ¥çœ‹å˜æ›´ä¸Šä¸‹æ–‡ |
| `normal` | æ ‡å‡† diff æ ¼å¼ | ç®€å•å·®å¼‚å¯¹æ¯” |
| `side-by-side` | å¹¶æ’å¯¹æ¯”æ ¼å¼ | å¯è§†åŒ–å¯¹æ¯” |
| `strict` | ä¸¥æ ¼æ¨¡å¼ï¼Œä»…æ˜¾ç¤ºå®é™…å·®å¼‚ | ç²¾ç¡®å·®å¼‚åˆ†æ |

### generate - æ¨¡æ¿ç”Ÿæˆ

```bash
# åŸºæœ¬ç”¨æ³•
confers generate --struct "AppConfig" --output config_template.toml

# æŒ‡å®šè¾“å‡ºæ ¼å¼
confers generate --struct "AppConfig" --format toml --output config.toml
confers generate --struct "AppConfig" --format yaml --output config.yaml
confers generate --struct "AppConfig" --format json --output config.json

# æŒ‡å®šè¾“å‡ºçº§åˆ«
confers generate --struct "AppConfig" --level minimal    # æœ€å°è¾“å‡º
confers generate --struct "AppConfig" --level full       # å®Œæ•´è¾“å‡º
confers generate --struct "AppConfig" --level doc        # æ–‡æ¡£åŒ–è¾“å‡º

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers generate --help
```

**è¾“å‡ºçº§åˆ«è¯´æ˜ï¼š**

| çº§åˆ« | æè¿° | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `minimal` | ä»…åŒ…å«å¿…éœ€å­—æ®µå’Œæ³¨é‡Š | å¿«é€Ÿå¼€å§‹ |
| `full` | åŒ…å«æ‰€æœ‰å­—æ®µã€é»˜è®¤å€¼å’Œæ³¨é‡Š | å®Œæ•´é…ç½® |
| `doc` | åŒ…å«å­—æ®µè¯´æ˜æ–‡æ¡£ | æ–‡æ¡£ç”Ÿæˆ |

### validate - é…ç½®éªŒè¯

```bash
# åŸºæœ¬ç”¨æ³• - éªŒè¯é…ç½®æ–‡ä»¶
confers validate config.toml

# æŒ‡å®šè¾“å‡ºçº§åˆ«
confers validate config.toml --level minimal    # æœ€å°è¾“å‡º
confers validate config.toml --level full       # å®Œæ•´è¾“å‡º
confers validate config.toml --level doc        # æ–‡æ¡£åŒ–è¾“å‡º

# è·³è¿‡ä¸¥æ ¼æ¨¡å¼
confers validate config.toml --no-strict

# éªŒè¯å¹¶ç”ŸæˆæŠ¥å‘Š
confers validate config.toml -o validation_report.md

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers validate --help
```

### encrypt - é…ç½®åŠ å¯†

```bash
# åŠ å¯†é…ç½®æ–‡ä»¶
confers encrypt input.toml --key-file secret.key --output encrypted.toml

# åŠ å¯†å•ä¸ªå€¼
confers encrypt "sensitive_value" --key-file secret.key

# è§£å¯†é…ç½®æ–‡ä»¶
confers encrypt encrypted.toml --key-file secret.key --decrypt --output decrypted.toml

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers encrypt --help
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```bash
# ç”Ÿæˆå¯†é’¥å¹¶åŠ å¯†
confers key -o secret.key
confers encrypt config.toml --key-file secret.key -o config.encrypted.toml

# è§£å¯†ä½¿ç”¨
confers encrypt config.encrypted.toml --key-file secret.key --decrypt -o config.toml
```

### wizard - äº¤äº’å¼å‘å¯¼

```bash
# å¯åŠ¨äº¤äº’å¼å‘å¯¼
confers wizard

# æŒ‡å®šé…ç½®æ–‡ä»¶ç±»å‹
confers wizard --format toml
confers wizard --format yaml
confers wizard --format json

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers wizard --help
```

**å‘å¯¼æµç¨‹ï¼š**

1. è¾“å…¥é…ç½®åç§°
2. è®¾ç½®æœåŠ¡å™¨å‚æ•°ï¼ˆhostã€portï¼‰
3. é…ç½®æ•°æ®åº“è¿æ¥ï¼ˆurlã€poolï¼‰
4. é…ç½®æ—¥å¿—çº§åˆ«
5. ç”Ÿæˆé…ç½®æ–‡ä»¶

### key - å¯†é’¥ç®¡ç†

```bash
# ç”Ÿæˆæ–°å¯†é’¥
confers key -o encryption.key

# ç”Ÿæˆ 256 ä½å¯†é’¥
confers key --length 256 -o encryption.key

# ä»å¯†ç æ´¾ç”Ÿå¯†é’¥
confers key --derive --password "your_password" -o derived.key

# æŸ¥çœ‹å¯†é’¥ä¿¡æ¯
confers key --info encryption.key

# æŸ¥çœ‹è¯¦ç»†å¸®åŠ©
confers key --help
```

---

## åŸºç¡€ç”¨æ³•

### å®šä¹‰é…ç½®ç»“æ„ä½“

<div style="padding:16px; margin: 16px 0">

ä½¿ç”¨ `#[derive(Config)]` å’Œ `#[config(...)]` å±æ€§æ¥é…ç½®ä½ çš„ç»“æ„ä½“ã€‚ä½ è¿˜å¯ä»¥åµŒå¥—ç»“æ„ä½“ï¼š

</div>

```rust
use serde::Deserialize;
use confers::Config;

#[derive(Config, Deserialize)]
struct DatabaseConfig {
    #[config(default = "\"localhost\".to_string()")]
    host: String,
    #[config(default = "5432")]
    port: u16,
}

#[derive(Config, Deserialize)]
#[config(env_prefix = "MYAPP", strict = true)]
struct MyConfig {
    #[config(default = "100")]
    timeout_ms: u64,
    
    // åµŒå¥—ç»“æ„ä½“
    db: DatabaseConfig,
    
    #[config(sensitive = true)] // åœ¨å®¡è®¡æ—¥å¿—ä¸­ä¼šè¢«è„±æ•
    api_key: String,
}
```

### åŠ è½½é…ç½®

`confers` é€šè¿‡ `ConfigLoader` æä¾›äº†å¤šç§åŒæ­¥å’Œå¼‚æ­¥åŠ è½½æ–¹æ³•ï¼š

```rust
// åŸºæœ¬åŒæ­¥åŠ è½½
let config = MyConfig::new_loader()
    .load_sync()?;

// è‡ªå®šä¹‰æ–‡ä»¶è·¯å¾„å’Œå†…å­˜é™åˆ¶
let config = MyConfig::new_loader()
    .with_file("custom.yaml")
    .with_memory_limit(10) // é™åˆ¶ä¸º 10MB
    .load_sync()?;

// å¼‚æ­¥åŠ è½½ï¼ˆé€‚ç”¨äºè¿œç¨‹é…ç½®ï¼‰
let config = MyConfig::new_loader()
    .load().await?;

// å¸¦å®¡è®¡æ—¥å¿—çš„åŠ è½½
#[cfg(feature = "audit")]
let config = MyConfig::new_loader()
    .load_sync_with_audit()?;

// å¸¦æ–‡ä»¶ç›‘æ§çš„åŠ è½½
#[cfg(feature = "watch")]
let (config, watcher) = MyConfig::new_loader()
    .load_sync_with_watcher()?;
```

### é»˜è®¤å€¼ä¸ç¯å¢ƒå˜é‡

- **é»˜è®¤å€¼**: ä½¿ç”¨ `#[config(default = "...")]`ã€‚æ³¨æ„å­—ç¬¦ä¸²éœ€è¦åŒå¼•å·è½¬ä¹‰ã€‚
- **ç¯å¢ƒå˜é‡**: é»˜è®¤æ˜ å°„è§„åˆ™ä¸º `PREFIX_FIELD_NAME`ã€‚ä¾‹å¦‚ `MYAPP_TIMEOUT_MS` æ˜ å°„åˆ° `timeout_ms`ã€‚

---

## é«˜çº§ç”¨æ³•

### éªŒè¯ä¸æ¸…æ´—

`confers` é›†æˆäº† `validator` åº“ï¼Œå…è®¸ä½ åœ¨åŠ è½½é…ç½®æ—¶è¿›è¡Œè‡ªåŠ¨éªŒè¯ï¼š

```rust
use validator::Validate;

#[derive(Config, Deserialize, Validate)]
#[config(validate)] // å¯ç”¨è‡ªåŠ¨éªŒè¯
struct MyConfig {
    #[validate(range(min = 1, max = 65535))]
    port: u16,
    
    #[validate(email)]
    admin_email: String,
}
```

ä½ è¿˜å¯ä»¥å®šä¹‰è‡ªå®šä¹‰çš„ `sanitizer` æ¥æ¸…æ´—æ•°æ®ï¼ˆä¾‹å¦‚å»é™¤é¦–å°¾ç©ºæ ¼ï¼‰ï¼š

```rust
let config = MyConfig::new_loader()
    .with_sanitizer(|mut cfg| {
        cfg.admin_email = cfg.admin_email.trim().to_lowercase();
        Ok(cfg)
    })
    .load_sync()?;
```

### è¿œç¨‹é…ç½® (Etcd/Consul/HTTP)

<div style="padding:16px; margin: 16px 0">

âš ï¸ **æ³¨æ„**: ä»¥ä¸‹åŠŸèƒ½éœ€è¦å¯ç”¨ `remote` ç‰¹æ€§ã€‚

</div>

é€šè¿‡å¯ç”¨ `remote` ç‰¹æ€§ï¼Œä½ å¯ä»¥ä»è¿œç¨‹æºåŠ è½½é…ç½®ã€‚`confers` æ”¯æŒèº«ä»½éªŒè¯å’Œ TLS åŠ å¯†ï¼š

```rust
// ä» Etcd åŠ è½½ï¼Œå¸¦èº«ä»½éªŒè¯å’Œ TLS
let config = MyConfig::new_loader()
    .with_remote_url("http://localhost:2379")
    .with_remote_auth("admin", "password")
    .with_remote_tls("ca.crt", "client.crt", "client.key")
    .load()
    .await?;

// ä» Consul åŠ è½½é…ç½®
let config = MyConfig::new_loader()
    .with_remote_url("consul://localhost:8500")
    .with_remote_token("your-consul-token")
    .load()
    .await?;

// ä» HTTP æ¥å£åŠ è½½ï¼Œå¸¦ Bearer Token
let config = MyConfig::new_loader()
    .with_remote("https://api.example.com/config")
    .with_remote_token("your-token")
    .load()
    .await?;
```

### å®¡è®¡æ—¥å¿—ä¸å®‰å…¨

<div style="padding:16px; margin: 16px 0">

ğŸ“ **æç¤º**: ä»¥ä¸‹åŠŸèƒ½éœ€è¦å¯ç”¨ `audit` ç‰¹æ€§ã€‚

</div>

å¯ç”¨ `audit` ç‰¹æ€§åï¼Œ`confers` å¯ä»¥è®°å½•é…ç½®åŠ è½½çš„å†å²ï¼Œå¹¶è‡ªåŠ¨å¯¹æ•æ„Ÿå­—æ®µè¿›è¡Œè„±æ•ã€‚ä½ è¿˜å¯ä»¥é™åˆ¶åŠ è½½è¿‡ç¨‹ä¸­çš„å†…å­˜å ç”¨ï¼š

```rust
#[derive(Config, Deserialize)]
#[config(audit)] // å¯ç”¨å®¡è®¡
struct SecureConfig {
    #[config(sensitive = true)]
    db_password: String,
}

// åŠ è½½æ—¶ä¼šè‡ªåŠ¨è¾“å‡ºå®¡è®¡æ—¥å¿—ï¼Œå¹¶é™åˆ¶å†…å­˜ä½¿ç”¨ä»¥é˜²æ­¢ OOM
let config = SecureConfig::new_loader()
    .with_audit_log(true)
    .with_audit_log_path("audit.log")
    .with_memory_limit(50) // é™åˆ¶ä¸º 50MB
    .load_sync()?;
```

### æ–‡ä»¶ç›‘å¬ä¸çƒ­é‡è½½

<div style="padding:16px; margin: 16px 0">

âœ¨ **æç¤º**: ä»¥ä¸‹åŠŸèƒ½éœ€è¦å¯ç”¨ `watch` ç‰¹æ€§ã€‚

</div>

`confers` æ”¯æŒç›‘å¬é…ç½®æ–‡ä»¶æˆ–è¿œç¨‹æºçš„å˜åŒ–ã€‚å¯ç”¨ `watch` ç‰¹æ€§åï¼Œä½ å¯ä»¥æ‰‹åŠ¨æ£€æŸ¥é…ç½®æ–‡ä»¶çš„å˜åŒ–å¹¶é‡æ–°åŠ è½½ï¼š

```rust
use std::time::Duration;

// å¯ç”¨ç›‘å¬åŠŸèƒ½
let config = MyConfig::new_loader()
    .with_file("config.toml")
    .with_watch(true)
    .load_sync()?;

println!("åˆå§‹é…ç½®å·²åŠ è½½ï¼Œæ¶ˆæ¯: {}", config.message);

// ç›‘æ§å˜åŒ–å¾ªç¯
let mut last_message = config.message.clone();

for i in 1..=5 {
    println!("\n[è¿­ä»£ {}] è¯·ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶ç­‰å¾…...", i);

    // æ¨¡æ‹Ÿå¤–éƒ¨å˜æ›´
    std::thread::sleep(Duration::from_millis(500));

    // æ£€æŸ¥æ˜¯å¦å‘ç”Ÿå˜åŒ–
    let current_config = MyConfig::new_loader()
        .with_file("config.toml")
        .load_sync()?;
    
    if current_config.message != last_message {
        println!(">>> é…ç½®å·²å˜æ›´ï¼æ–°æ¶ˆæ¯: {}", current_config.message);
        last_message = current_config.message.clone();
    } else {
        println!("å°šæœªæ£€æµ‹åˆ°å˜æ›´...");
    }
}
```

### é…ç½®å·®åˆ†å¯¹æ¯”

ä½¿ç”¨ `confers` çš„é…ç½®å·®åˆ†åŠŸèƒ½ï¼Œå¯ä»¥æ¯”è¾ƒä¸åŒç¯å¢ƒæˆ–ç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶å·®å¼‚ï¼š

```rust
use confers::commands::{DiffCommand, DiffOptions, DiffFormat};

// æ¯”è¾ƒä¸¤ä¸ªé…ç½®æ–‡ä»¶
let options = DiffOptions {
    format: DiffFormat::Unified,
    context_lines: 5,
    show_line_numbers: true,
    ..Default::default()
};

DiffCommand::execute("development.toml", "production.toml", options)?;

// æˆ–è€…ä½¿ç”¨å¹¶æ’æ ¼å¼
let side_by_side_options = DiffOptions {
    format: DiffFormat::SideBySide,
    context_lines: 3,
    show_line_numbers: false,
    ..Default::default()
};

DiffCommand::execute("development.toml", "production.toml", side_by_side_options)?;
```

**å‘½ä»¤è¡Œæ–¹å¼ï¼š**

```bash
# ä½¿ç”¨ CLI è¿›è¡Œé…ç½®å·®åˆ†
confers diff development.toml production.toml --format unified -o diff_report.md
```

### æ•æ„Ÿæ•°æ®åŠ å¯†

`confers` ä½¿ç”¨ AES-256 åŠ å¯†ç®—æ³•ä¿æŠ¤æ•æ„Ÿé…ç½®ä¿¡æ¯ï¼š

```rust
use confers::encryption::ConfigEncryption;
use confers::key::KeyManager;
use std::path::PathBuf;

// åˆ›å»ºå¯†é’¥ç®¡ç†å™¨å¹¶ç”Ÿæˆå¯†é’¥
let mut km = KeyManager::new(PathBuf::from("./keys"))?;
let key = km.generate_key()?;

// åˆ›å»ºåŠ å¯†å™¨
let encryption = ConfigEncryption::new(key);

// åŠ å¯†æ•æ„Ÿé…ç½®
let encrypted = encryption.encrypt("super_secret_password")?;

// è§£å¯†é…ç½®
let decrypted = encryption.decrypt(&encrypted)?;
```

**å‘½ä»¤è¡Œæ–¹å¼ï¼š**

```bash
# ç”Ÿæˆå¯†é’¥
confers key -o encryption.key

# åŠ å¯†é…ç½®æ–‡ä»¶
confers encrypt config.toml --key-file encryption.key -o config.encrypted.toml

# è§£å¯†é…ç½®æ–‡ä»¶
confers encrypt config.encrypted.toml --key-file encryption.key --decrypt -o config.toml
```

---

## æœ€ä½³å®è·µ

<div align="center" style="margin: 24px 0">

### ğŸŒŸ æ¨èçš„è®¾è®¡æ¨¡å¼

</div>

<table style="width:100%; border-collapse: collapse">
<tr>
<td width="50%" style="padding: 16px">

### âœ… æ¨èåšæ³•

- **åˆ†å±‚é…ç½®**: å°†é…ç½®æ‹†åˆ†ä¸ºå¤šä¸ªå°ç»“æ„ä½“ï¼ˆå¦‚ `DatabaseConfig`, `ServerConfig`ï¼‰ï¼Œç„¶åç»„åˆè¿› `AppConfig`ã€‚
- **ç¯å¢ƒéš”ç¦»**: ä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ `env_prefix`ï¼ˆå¦‚ `DEV_`, `PROD_`ï¼‰ã€‚
- **é˜²å¾¡æ€§åŠ è½½**: å§‹ç»ˆä¸ºå¯é€‰å­—æ®µä½¿ç”¨ `Option<T>`ï¼Œå¹¶ä¸ºå…³é”®å­—æ®µæä¾› `default` å€¼ã€‚
- **éªŒè¯ä¸æ¸…æ´—**: å§‹ç»ˆå¯ç”¨ `validate` å±æ€§ï¼Œå¹¶ä½¿ç”¨ `with_sanitizer` æ¸…ç†è¾“å…¥ï¼ˆå¦‚å»é™¤å­—ç¬¦ä¸²é¦–å°¾ç©ºæ ¼ï¼‰ã€‚
- **å®‰å…¨æ€§**: æ•æ„Ÿå­—æ®µæ ‡è®° `sensitive = true` ä»¥é˜²å®¡è®¡æ—¥å¿—æ³„éœ²ã€‚

</td>
<td width="50%" style="padding: 16px">

### âŒ é¿å…åšæ³•

- **å…¨å±€é™æ€å˜é‡**: å°½é‡é¿å…ä½¿ç”¨å…¨å±€ `static` å­˜å‚¨é…ç½®ï¼Œæ¨èé€šè¿‡ä¾èµ–æ³¨å…¥æˆ– `Arc` ä¼ é€’é…ç½®ã€‚
- **å¿½ç•¥é”™è¯¯**: ç”Ÿäº§ç¯å¢ƒåº”ä¸¥æ ¼æ£€æŸ¥ `ConfigError`ï¼Œç‰¹åˆ«æ˜¯ `MemoryLimitExceeded` å’Œ `ValidationError`ã€‚
- **ç¡¬ç¼–ç **: ä»»ä½•å¯èƒ½éšç¯å¢ƒå˜åŒ–çš„å‚æ•°éƒ½åº”é€šè¿‡é…ç½®ç®¡ç†ï¼Œè€Œéç¡¬ç¼–ç ã€‚
- **æ•æ„Ÿä¿¡æ¯æ˜æ–‡å­˜å‚¨**: æ•æ„Ÿé…ç½®åº”ä½¿ç”¨åŠ å¯†åŠŸèƒ½ä¿æŠ¤ã€‚

</td>
</tr>
</table>

---

## å®‰å…¨é…ç½®æœ€ä½³å®è·µ

<div align="center" style="margin: 24px 0">

### ğŸ”’ å®‰å…¨é…ç½®æŒ‡å—

</div>

<div style="padding:16px; margin: 16px 0">

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ­£ç¡®é…ç½®å®‰å…¨é€‰é¡¹è‡³å…³é‡è¦ã€‚æœ¬èŠ‚ä»‹ç»å¦‚ä½•å®‰å…¨åœ°ä½¿ç”¨ `confers` çš„å„ç§å®‰å…¨åŠŸèƒ½ã€‚

</div>

### 1. æ•æ„Ÿæ•°æ®å¤„ç†

<div style="padding:16px; margin: 16px 0">

**âš ï¸ é‡è¦**: æ°¸è¿œä¸è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ˜æ–‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€API å¯†é’¥ã€ä»¤ç‰Œç­‰ï¼‰ã€‚

</div>

```rust
use confers::Config;
use serde::Deserialize;

#[derive(Config, Deserialize)]
#[config(env_prefix = "APP")]
struct SecureConfig {
    // æ ‡è®°æ•æ„Ÿå­—æ®µï¼Œå®¡è®¡æ—¥å¿—ä¼šè‡ªåŠ¨è„±æ•
    #[config(sensitive = true)]
    database_password: String,
    
    #[config(sensitive = true)]
    api_key: String,
    
    // éæ•æ„Ÿå­—æ®µ
    server_name: String,
}
```

**æ¨èåšæ³•ï¼š**

- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- ä½¿ç”¨ `confers encrypt` å‘½ä»¤åŠ å¯†æ•æ„Ÿé…ç½®
- åœ¨å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼ˆå¦‚ AWS Secrets Managerã€HashiCorp Vaultï¼‰ä¸­å­˜å‚¨å¯†é’¥

### 2. é…ç½®åŠ å¯†

<div style="padding:16px; margin: 16px 0">

ä½¿ç”¨ AES-256-GCM åŠ å¯†ç®—æ³•ä¿æŠ¤æ•æ„Ÿé…ç½®ä¿¡æ¯ã€‚

</div>

```rust
use confers::encryption::ConfigEncryption;

// ä»ç¯å¢ƒå˜é‡åŠ è½½åŠ å¯†å¯†é’¥
let encryption = ConfigEncryption::from_env()?;

// åŠ å¯†æ•æ„Ÿå€¼
let encrypted_password = encryption.encrypt("my_secret_password")?;

// è§£å¯†é…ç½®
let decrypted_password = encryption.decrypt(&encrypted_password)?;
```

**å‘½ä»¤è¡Œæ–¹å¼ï¼š**

```bash
# è®¾ç½®åŠ å¯†å¯†é’¥ç¯å¢ƒå˜é‡ (æ”¯æŒ CONFERS_ENCRYPTION_KEY æˆ– CONFERS_KEY)
export CONFERS_ENCRYPTION_KEY=$(openssl rand -base64 32)
# æˆ–è€…
export CONFERS_KEY=$(openssl rand -base64 32)

# åŠ å¯†æ•æ„Ÿé…ç½®å€¼
confers encrypt "my-secret-value"

# å°†åŠ å¯†ç»“æœä¿å­˜åˆ°æ–‡ä»¶
confers encrypt "my-secret-value" --output encrypted.txt
```

### 3. å¯†é’¥ç®¡ç†

<div style="padding:16px; margin: 16px 0">

**âš ï¸ é‡è¦**: å¯†é’¥å¿…é¡»å®‰å…¨å­˜å‚¨ï¼Œç»ä¸èƒ½æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚

</div>

```rust
use confers::key::KeyManager;
use std::path::PathBuf;

// åˆ›å»ºå¯†é’¥ç®¡ç†å™¨
let mut key_manager = KeyManager::new(PathBuf::from("./secure_keys"))?;

// åˆå§‹åŒ–å¯†é’¥ç¯ï¼ˆä»…é¦–æ¬¡ï¼‰
let master_key = [0u8; 32]; // ä»å®‰å…¨ä½ç½®è·å–
let version = key_manager.initialize(
    &master_key,
    "production".to_string(),
    "security-team".to_string()
)?;

// å®šæœŸè½®æ¢å¯†é’¥ï¼ˆå»ºè®®æ¯ 90 å¤©ï¼‰
let rotation_result = key_manager.rotate_key(
    &master_key,
    Some("production".to_string()),
    "security-team".to_string(),
    Some("Scheduled rotation".to_string())
)?;

println!("å¯†é’¥å·²ä»ç‰ˆæœ¬ {} è½®æ¢åˆ° {}", 
    rotation_result.previous_version, 
    rotation_result.new_version);
```

**å¯†é’¥ç®¡ç†æœ€ä½³å®è·µï¼š**

- âœ… ä½¿ç”¨ç¡¬ä»¶å®‰å…¨æ¨¡å—ï¼ˆHSMï¼‰æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
- âœ… å®šæœŸè½®æ¢å¯†é’¥ï¼ˆå»ºè®®æ¯ 90 å¤©ï¼‰
- âœ… ä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„å¯†é’¥
- âœ… ä½¿ç”¨å¼ºéšæœºæ•°ç”Ÿæˆå™¨åˆ›å»ºå¯†é’¥
- âŒ ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
- âŒ ä¸è¦å°†å¯†é’¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
- âŒ ä¸è¦åœ¨æ—¥å¿—ä¸­è®°å½•å¯†é’¥

### 4. å®¡è®¡æ—¥å¿—é…ç½®

<div style="padding:16px; margin: 16px 0">

é…ç½®å®¡è®¡æ—¥å¿—ä»¥è·Ÿè¸ªæ‰€æœ‰é…ç½®åŠ è½½å’Œä¿®æ”¹æ“ä½œã€‚

</div>

```rust
use confers::audit::{AuditLogger, AuditConfig};
use std::path::PathBuf;

// åˆ›å»ºå®¡è®¡é…ç½®
let audit_config = AuditConfig {
    validation_error: Some("Invalid configuration".to_string()),
    config_source: Some("config.toml".to_string()),
    load_duration: Some(100),
    ..Default::default()
};

// è®°å½•é…ç½®åŠ è½½
AuditLogger::log_to_file_with_source(
    &config,
    &PathBuf::from("/var/log/confers/audit.log"),
    audit_config
)?;
```

**å®¡è®¡æ—¥å¿—æœ€ä½³å®è·µï¼š**

- âœ… å°†å®¡è®¡æ—¥å¿—å­˜å‚¨åœ¨å®‰å…¨ä½ç½®ï¼ˆå¦‚ `/var/log/confers/`ï¼‰
- âœ… é…ç½®æ—¥å¿—è½®è½¬ä»¥é˜²æ­¢ç£ç›˜ç©ºé—´è€—å°½
- âœ… é™åˆ¶å®¡è®¡æ—¥å¿—æ–‡ä»¶çš„è®¿é—®æƒé™ï¼ˆä»… root/administratorï¼‰
- âœ… ç›‘æ§å®¡è®¡æ—¥å¿—ä¸­çš„å¯ç–‘æ´»åŠ¨
- âœ… å®ç°æ—¥å¿—ä¿ç•™ç­–ç•¥ä»¥æ»¡è¶³åˆè§„æ€§è¦æ±‚

### 5. è¿œç¨‹é…ç½®å®‰å…¨

<div style="padding:16px; margin: 16px 0">

ä»è¿œç¨‹æºåŠ è½½é…ç½®æ—¶ï¼Œå¿…é¡»ç¡®ä¿è¿æ¥å®‰å…¨ã€‚

</div>

```rust
use confers::Config;

// ä½¿ç”¨ TLS åŠ å¯†è¿æ¥
let config = MyConfig::new_loader()
    .with_remote_url("https://config.example.com")
    .with_remote_tls(
        Some("/path/to/ca.crt".to_string()),
        Some("/path/to/client.crt".to_string()),
        Some("/path/to/client.key".to_string())
    )
    .with_remote_token("secure_token") // ä½¿ç”¨ Bearer Token
    .load()
    .await?;

// æˆ–è€…ä½¿ç”¨ç”¨æˆ·å/å¯†ç è®¤è¯
let config = MyConfig::new_loader()
    .with_remote_url("https://config.example.com")
    .with_remote_auth_secure(
        "username".to_string(),
        std::sync::Arc::new(confers::security::SecureString::new(
            "password".to_string(),
            confers::security::SensitivityLevel::High
        ))
    )
    .load_sync()?;
```

**è¿œç¨‹é…ç½®å®‰å…¨æœ€ä½³å®è·µï¼š**

- âœ… å§‹ç»ˆä½¿ç”¨ HTTPS/TLS åŠ å¯†è¿æ¥
- âœ… ä½¿ç”¨å¼ºå¯†ç å’Œå®‰å…¨çš„è®¤è¯ä»¤ç‰Œ
- âœ… å®šæœŸè½®æ¢è®¤è¯å‡­æ®
- âœ… ä½¿ç”¨è¯ä¹¦éªŒè¯æœåŠ¡å™¨èº«ä»½
- âœ… é…ç½®è¶…æ—¶ä»¥é˜²æ­¢é•¿æ—¶é—´æŒ‚èµ·
- âŒ ä¸è¦åœ¨ URL ä¸­ä¼ é€’æ•æ„Ÿä¿¡æ¯
- âŒ ä¸è¦ä½¿ç”¨ä¸å®‰å…¨çš„ HTTP è¿æ¥

### 6. é…ç½®éªŒè¯

<div style="padding:16px; margin: 16px 0">

ä½¿ç”¨éªŒè¯å™¨ç¡®ä¿é…ç½®å€¼åœ¨é¢„æœŸèŒƒå›´å†…ã€‚

</div>

```rust
use confers::validator::{ValidationEngine, RangeFieldValidator};
use serde_json::json;

// åˆ›å»ºéªŒè¯å¼•æ“
let mut engine = ValidationEngine::new();

// æ·»åŠ èŒƒå›´éªŒè¯å™¨
engine.add_validator(Box::new(RangeFieldValidator::new(
    "port", 
    Some(1024.0), 
    Some(65535.0)
)));

// éªŒè¯é…ç½®
let config = json!({"port": 8080});
match engine.validate(&config) {
    Ok(()) => println!("é…ç½®éªŒè¯é€šè¿‡"),
    Err(errors) => {
        eprintln!("é…ç½®éªŒè¯å¤±è´¥:");
        for error in errors {
            eprintln!("  - {}", error.message);
        }
    }
}
```

**é…ç½®éªŒè¯æœ€ä½³å®è·µï¼š**

- âœ… éªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥
- âœ… ç¡®ä¿æ•°å€¼åœ¨é¢„æœŸèŒƒå›´å†…
- âœ… éªŒè¯å­—ç¬¦ä¸²æ ¼å¼ï¼ˆå¦‚ URLã€é‚®ç®±ï¼‰
- âœ… è®°å½•æ‰€æœ‰éªŒè¯å¤±è´¥
- âœ… å°†éªŒè¯å¤±è´¥è§†ä¸ºæ½œåœ¨å®‰å…¨äº‹ä»¶
- âŒ ä¸è¦ä¸ºäº†ä¾¿åˆ©è€Œç»•è¿‡éªŒè¯

### 7. ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ¸…å•

<div style="padding:16px; margin: 16px 0">

åœ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹å®‰å…¨é¡¹ç›®ï¼š

</div>

<table style="width:100%; border-collapse: collapse">
<tr>
<th style="padding: 12px; text-align: left; background-color: #F3F4F6">å®‰å…¨é¡¹ç›®</th>
<th style="padding: 12px; text-align: left; background-color: #F3F4F6">çŠ¶æ€</th>
<th style="padding: 12px; text-align: left; background-color: #F3F4F6">è¯´æ˜</th>
</tr>
<tr>
<td style="padding: 12px">æ•æ„Ÿæ•°æ®åŠ å¯†</td>
<td style="padding: 12px">â˜</td>
<td style="padding: 12px">æ‰€æœ‰æ•æ„Ÿä¿¡æ¯éƒ½å·²åŠ å¯†</td>
</tr>
<tr>
<td style="padding: 12px">å¯†é’¥ç®¡ç†</td>
<td style="padding: 12px">â˜</td>
<td style="padding: 12px">å¯†é’¥å®‰å…¨å­˜å‚¨ï¼Œå®šæœŸè½®æ¢</td>
</tr>
<tr>
<td style="padding: 12px">å®¡è®¡æ—¥å¿—</td>
<td style="padding: 12px">â˜</td>
<td style="padding: 12px">å®¡è®¡æ—¥å¿—å·²å¯ç”¨ï¼Œå®‰å…¨å­˜å‚¨</td>
</tr>
<tr>
<td style="padding: 12px">é…ç½®éªŒè¯</td>
<td style="padding: 12px">â˜</td>
<td style="padding: 12px">æ‰€æœ‰é…ç½®éƒ½ç»è¿‡éªŒè¯</td>
</tr>
<tr>
<td style="padding: 12px">TLS åŠ å¯†</td>
<td style="padding: 12px">â˜</td>
<td style="padding: 12px">è¿œç¨‹è¿æ¥ä½¿ç”¨ TLS</td>
</tr>
<tr>
<td style="padding: 12px">è®¿é—®æ§åˆ¶</td>
<td style="padding: 12px">â˜</td>
<td style="padding: 12px">é…ç½®æ–‡ä»¶è®¿é—®æƒé™å—é™</td>
</tr>
<tr>
<td style="padding: 12px">é”™è¯¯å¤„ç†</td>
<td style="padding: 12px">â˜</td>
<td style="padding: 12px">é”™è¯¯ä¿¡æ¯ä¸æ³„éœ²æ•æ„Ÿæ•°æ®</td>
</tr>
<tr>
<td style="padding: 12px">æ—¥å¿—è„±æ•</td>
<td style="padding: 12px">â˜</td>
<td style="padding: 12px">æ•æ„Ÿå­—æ®µæ ‡è®°ä¸º sensitive</td>
</tr>
</table>

---

## æ•…éšœæ’é™¤

<div style="padding:16px; margin: 16px 0">

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| **â“ ç¯å¢ƒå˜é‡æ²¡æœ‰ç”Ÿæ•ˆ** | 1. æ£€æŸ¥ `#[config(env_prefix = "APP")]` æ˜¯å¦æ­£ç¡®è®¾ç½®ã€‚<br>2. ç¯å¢ƒå˜é‡ååº”ä¸º `PREFIX_FIELD_NAME`ï¼ˆå…¨å¤§å†™ï¼‰ã€‚<br>3. å¯¹äºåµŒå¥—ç»“æ„ä½“ï¼Œä½¿ç”¨åŒä¸‹åˆ’çº¿ï¼Œä¾‹å¦‚ `APP_DB__HOST` æ˜ å°„åˆ° `db.host`ã€‚ |
| **â“ åŠ è½½æ—¶æŠ¥ MemoryLimitExceeded é”™è¯¯** | 1. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦è¿‡å¤§ï¼Œæˆ–è€…æ˜¯å¦å­˜åœ¨å¾ªç¯å¼•ç”¨çš„é…ç½®ã€‚<br>2. è°ƒå¤§ `with_memory_limit(mb)` çš„é˜ˆå€¼ï¼ˆé»˜è®¤ä¸é™åˆ¶ï¼‰ã€‚ |
| **â“ éªŒè¯å¤±è´¥ ValidationError** | 1. æ£€æŸ¥ `validator` çš„çº¦æŸé€»è¾‘ã€‚`confers` ä¼šåœ¨åŠ è½½åç«‹å³è¿è¡ŒéªŒè¯ã€‚<br>2. æŸ¥çœ‹é”™è¯¯è¾“å‡ºï¼Œå®ƒä¼šæŒ‡æ˜å“ªä¸ªå­—æ®µæœªæ»¡è¶³å“ªä¸ªçº¦æŸã€‚ |
| **â“ è¿œç¨‹é…ç½®åŠ è½½å¤±è´¥ RemoteError** | 1. æ£€æŸ¥ç½‘ç»œè¿æ¥åŠ URL æ˜¯å¦æ­£ç¡®ã€‚<br>2. å¦‚æœå¯ç”¨äº† TLSï¼Œç¡®ä¿è¯ä¹¦è·¯å¾„æ­£ç¡®ä¸”æœ‰æ•ˆã€‚<br>3. æ£€æŸ¥èº«ä»½éªŒè¯ä»¤ç‰Œæˆ–ç”¨æˆ·åå¯†ç æ˜¯å¦è¿‡æœŸã€‚ |

</div>

<div align="center" style="margin: 24px 0">

**ğŸ’¬ ä»ç„¶éœ€è¦å¸®åŠ©ï¼Ÿ** [æäº¤ Issue](https://github.com/Kirky-X/confers/issues) æˆ– [è®¿é—®æ–‡æ¡£ä¸­å¿ƒ](https://github.com/project/confers)

</div>

---

## åç»­æ­¥éª¤

<div align="center" style="margin: 24px 0">

### ğŸ¯ ç»§ç»­æ¢ç´¢

</div>

<table style="width:100%; border-collapse: collapse">
<tr>
<td align="center" width="33%" style="padding: 16px">
<a href="API_REFERENCE.md">
<div style="padding: 24px; transition: transform 0.2s">
<img src="https://img.icons8.com/fluency/96/000000/graduation-cap.png" width="48" height="48"><br>
<b style="color:#1E293B">ğŸ“š API å‚è€ƒ</b>
</div>
</a>
<br><span style="color:#64748B">è¯¦ç»†çš„æ¥å£è¯´æ˜</span>
</td>
<td align="center" width="33%" style="padding: 16px">
<a href="ARCHITECTURE.md">
<div style="padding: 24px; transition: transform 0.2s">
<img src="https://img.icons8.com/fluency/96/000000/settings.png" width="48" height="48"><br>
<b style="color:#1E293B">ğŸ”§ æ¶æ„è®¾è®¡</b>
</div>
</a>
<br><span style="color:#64748B">æ·±å…¥äº†è§£å†…éƒ¨æœºåˆ¶</span>
</td>
<td align="center" width="33%" style="padding: 16px">
<a href="../examples/">
<div style="padding: 24px; transition: transform 0.2s">
<img src="https://img.icons8.com/fluency/96/000000/code.png" width="48" height="48"><br>
<b style="color:#1E293B">ğŸ’» ç¤ºä¾‹ä»£ç </b>
</div>
</a>
<br><span style="color:#64748B">çœŸå®åœºæ™¯çš„ä»£ç æ ·ä¾‹</span>
</td>
</tr>
</table>

---

<div align="center" style="margin: 32px 0; padding: 24px">

**[ğŸ“– API æ–‡æ¡£](https://docs.rs/confers)** â€¢ **[â“ å¸¸è§é—®é¢˜](FAQ.md)** â€¢ **[ğŸ› æŠ¥å‘Šé—®é¢˜](https://github.com/Kirky-X/confers/issues)**

**ç”± Kirky.X ç”¨ â¤ï¸ åˆ¶ä½œ**

**[â¬† è¿”å›é¡¶éƒ¨](#top)**

</div>
